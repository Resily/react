{"ast":null,"code":"export default function getFamilyUnits(family) {\n  var familyUnits = [],\n      familyUnitByParent = {},\n      index,\n      len;\n\n  function FamilySiblings() {\n    this.fromIndex = 0;\n    this.toIndex = 0;\n    this.items = [];\n    this.hash = {};\n  }\n\n  function FamilyUnit(id) {\n    this.id = id;\n    this.parents = new FamilySiblings();\n    this.children = new FamilySiblings();\n\n    this.loopSiblings = function (thisArg, itemid, onItem) {\n      this._loop(thisArg, this.parents.hash.hasOwnProperty(itemid) ? this.parents.items : this.children.items, onItem);\n    };\n\n    this.loopNonSiblings = function (thisArg, itemid, onItem) {\n      this._loop(thisArg, !this.parents.hash.hasOwnProperty(itemid) ? this.parents.items : this.children.items, onItem);\n    };\n\n    this.loop = function (thisArg, onItem) {\n      this._loop(thisArg, this.parents.items, onItem);\n\n      this._loop(thisArg, this.children.items, onItem);\n    };\n\n    this._loop = function (thisArg, items, onItem) {\n      if (onItem != null) {\n        for (var index = 0, len = items.length; index < len; index += 1) {\n          var sibling = items[index];\n          onItem.call(thisArg, sibling);\n        }\n      }\n    };\n\n    this.addParent = function (itemid) {\n      this._add(itemid, this.parents);\n    };\n\n    this.addChild = function (itemid) {\n      this._add(itemid, this.children);\n    };\n\n    this._add = function (itemid, siblings) {\n      if (!siblings.hash.hasOwnProperty(itemid)) {\n        siblings.items.push(itemid);\n        siblings.hash[itemid] = true;\n      }\n    };\n  }\n\n  index = 0;\n  family.loop(this, function (itemid, item) {\n    var childrenCount = family.countChildren(itemid);\n\n    if (childrenCount > 0) {\n      if (!familyUnitByParent.hasOwnProperty(itemid)) {\n        var familyUnit = new FamilyUnit(index);\n        index += 1;\n        familyUnit.addParent(itemid);\n        family.loopChildren(this, itemid, function (childid, child) {\n          familyUnit.addChild(childid);\n\n          if (childrenCount == 1) {\n            family.loopParents(this, childid, function (parentid) {\n              familyUnit.addParent(parentid);\n              familyUnitByParent[parentid] = familyUnit;\n              return family.SKIP;\n            });\n          }\n\n          return family.SKIP;\n        });\n        familyUnits.push(familyUnit);\n        familyUnitByParent[itemid] = familyUnit;\n      }\n    }\n  });\n  var familyUnitByItemId = {};\n\n  for (index = 0, len = familyUnits.length; index < len; index += 1) {\n    var familyUnit = familyUnits[index];\n    familyUnit.loop(this, function (itemid) {\n      if (!familyUnitByItemId.hasOwnProperty(itemid)) {\n        familyUnitByItemId[itemid] = [familyUnit];\n      } else {\n        familyUnitByItemId[itemid].push(familyUnit);\n      }\n    });\n  }\n\n  return familyUnitByItemId;\n}\n;","map":{"version":3,"sources":["/Users/01005901/go/src/github.com/Resily/react/node_modules/basicprimitives/src/algorithms/getFamilyUnits.js"],"names":["getFamilyUnits","family","familyUnits","familyUnitByParent","index","len","FamilySiblings","fromIndex","toIndex","items","hash","FamilyUnit","id","parents","children","loopSiblings","thisArg","itemid","onItem","_loop","hasOwnProperty","loopNonSiblings","loop","length","sibling","call","addParent","_add","addChild","siblings","push","item","childrenCount","countChildren","familyUnit","loopChildren","childid","child","loopParents","parentid","SKIP","familyUnitByItemId"],"mappings":"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","sourcesContent":["export default function getFamilyUnits(family) {\n  var familyUnits = [],\n    familyUnitByParent = {},\n    index,\n    len;\n\n  function FamilySiblings() {\n    this.fromIndex = 0;\n    this.toIndex = 0;\n    this.items = [];\n    this.hash = {};\n  }\n\n  function FamilyUnit(id) {\n    this.id = id;\n    this.parents = new FamilySiblings();\n    this.children = new FamilySiblings();\n\n    this.loopSiblings = function (thisArg, itemid, onItem) {\n      this._loop(thisArg, this.parents.hash.hasOwnProperty(itemid) ? this.parents.items : this.children.items, onItem);\n    };\n\n    this.loopNonSiblings = function (thisArg, itemid, onItem) {\n      this._loop(thisArg, !this.parents.hash.hasOwnProperty(itemid) ? this.parents.items : this.children.items, onItem);\n    };\n\n    this.loop = function (thisArg, onItem) {\n      this._loop(thisArg, this.parents.items, onItem);\n      this._loop(thisArg, this.children.items, onItem);\n    };\n\n    this._loop = function (thisArg, items, onItem) {\n      if (onItem != null) {\n        for (var index = 0, len = items.length; index < len; index += 1) {\n          var sibling = items[index];\n          onItem.call(thisArg, sibling);\n        }\n      }\n    };\n\n    this.addParent = function (itemid) {\n      this._add(itemid, this.parents);\n    };\n\n    this.addChild = function (itemid) {\n      this._add(itemid, this.children);\n    };\n\n    this._add = function (itemid, siblings) {\n      if (!siblings.hash.hasOwnProperty(itemid)) {\n        siblings.items.push(itemid);\n        siblings.hash[itemid] = true;\n      }\n    };\n  }\n\n  index = 0;\n  family.loop(this, function (itemid, item) {\n    var childrenCount = family.countChildren(itemid);\n    if (childrenCount > 0) {\n      if (!familyUnitByParent.hasOwnProperty(itemid)) {\n        var familyUnit = new FamilyUnit(index);\n        index += 1;\n        familyUnit.addParent(itemid);\n        family.loopChildren(this, itemid, function (childid, child) {\n          familyUnit.addChild(childid);\n          if (childrenCount == 1) {\n            family.loopParents(this, childid, function (parentid) {\n              familyUnit.addParent(parentid);\n              familyUnitByParent[parentid] = familyUnit;\n              return family.SKIP;\n            });\n          }\n          return family.SKIP;\n        });\n        familyUnits.push(familyUnit);\n        familyUnitByParent[itemid] = familyUnit;\n      }\n    }\n  });\n\n  var familyUnitByItemId = {};\n  for (index = 0, len = familyUnits.length; index < len; index += 1) {\n    var familyUnit = familyUnits[index];\n    familyUnit.loop(this, function (itemid) {\n      if (!familyUnitByItemId.hasOwnProperty(itemid)) {\n        familyUnitByItemId[itemid] = [familyUnit];\n      } else {\n        familyUnitByItemId[itemid].push(familyUnit);\n      }\n    });\n  }\n\n  return familyUnitByItemId;\n};"]},"metadata":{},"sourceType":"module"}