{"ast":null,"code":"import Point from './graphics/structs/Point';\nimport Thickness from './graphics/structs/Thickness';\nimport Rect from './graphics/structs/Rect';\nimport { UpdateMode, OrientationType } from './enums';\nimport { isNullOrEmpty } from './common';\nimport createGraphics, { isChrome } from './graphics/createGraphics';\nimport { getFixOfPixelAlignment, getInnerSize, getElementOffset } from './graphics/dom';\nimport JsonML from './common/jsonml-html';\nimport { mergeObjects } from './common';\n/**\n * JavaScript Abstract Control\n * @class BaseControl\n */\n\nexport default function BaseControl(element, options, taskManagerFactory, eventArgsFactory, templates) {\n  var _data = {\n    name: \"orgdiagram\",\n    options: options,\n    tasks: null,\n    graphics: null,\n    mouse: null,\n    layout: {\n      element: element,\n      controlPanel: null,\n      frameMousePanel: null,\n      framePlaceholder: null,\n      titlesMousePanel: null,\n      titlesPlaceholder: null,\n      scrollPanel: null,\n      mousePanel: null,\n      placeholder: null,\n      calloutPlaceholder: null,\n      forceCenterOnCursor: true\n    }\n  },\n      _dragFrom,\n      _scrollFrom,\n      _scrollTo,\n      _dragImage,\n      _dragTimer,\n      _debug = false,\n      _timer = null;\n  /**\n   * Performs full redraw of the diagram contents via reevaluating all API options. This method has to be called explicitly\n   * after all options are set in order to update controls contents.\n   * \n   * @param {UpdateMode} updateMode \n   * @param {boolean} forceCenterOnCursor \n   */\n\n\n  function update(updateMode, forceCenterOnCursor) {\n    if (forceCenterOnCursor == null) {\n      forceCenterOnCursor = true;\n    }\n\n    switch (updateMode) {\n      case UpdateMode.Refresh:\n        refresh(forceCenterOnCursor, _debug);\n        break;\n\n      case UpdateMode.PositonHighlight:\n        positionHighlight(_debug);\n        break;\n\n      default:\n        redraw();\n        break;\n    }\n  }\n  /**\n   * Removes all elements control added to DOM including event listeners.\n   */\n\n\n  function destroy() {\n    unbind(_data.layout);\n    cleanLayout(_data.layout);\n    _data.tasks = null;\n    _data.graphics = null;\n  }\n\n  function redraw() {\n    unbind(_data.layout);\n    cleanLayout(_data.layout);\n    createLayout(_data.layout, _data.name);\n    bind(_data.layout);\n    _data.tasks = taskManagerFactory(getOptions, getGraphics, getLayout, setLayout, templates);\n    _data.graphics = createGraphics(_data.options.graphicsType, _data.layout.element);\n    _data.graphics.debug = _debug;\n    refresh(true, _debug);\n  }\n\n  function refresh(forceCenterOnCursor, debug) {\n    var centerOnCursorTask, placeholderOffset; //_data.layout.scrollPanel.css({\n    //  \"display\": \"none\",\n    //  \"-webkit-overflow-scrolling\": \"auto\"\n    //});\n    //this.graphics.begin();\n\n    _data.layout.forceCenterOnCursor = forceCenterOnCursor;\n\n    _data.tasks.process('OptionsTask', null, debug);\n\n    _data.graphics.end(); //_data.layout.scrollPanel.css({\n    //  \"display\": \"block\"\n    //});\n\n\n    if (forceCenterOnCursor) {\n      /* scroll to offset */\n      centerOnCursorTask = _data.tasks.getTask(\"CenterOnCursorTask\");\n      placeholderOffset = centerOnCursorTask.getPlaceholderOffset();\n      _data.layout.scrollPanel.scrollLeft = placeholderOffset.x;\n      _data.layout.scrollPanel.scrollTop = placeholderOffset.y;\n    } //_data.layout.scrollPanel.css({\n    //  \"-webkit-overflow-scrolling\": \"touch\"\n    //});\n\n    /* fix pixel alignment */\n\n\n    var pixelAlignmentFix = getFixOfPixelAlignment(_data.layout.element);\n    JsonML.applyStyles(_data.layout.scrollPanel, {\n      \"marginBottom\": \"0px\",\n      \"marginRight\": \"0px\",\n      \"marginLeft\": pixelAlignmentFix.width + \"px\",\n\n      /* fixes div pixel alignment */\n      \"marginTop\": pixelAlignmentFix.height + \"px\"\n    });\n  }\n\n  function positionHighlight(debug) {\n    _data.layout.forceCenterOnCursor = false;\n\n    _data.tasks.process('HighlightItemOptionTask', null, debug);\n\n    _data.graphics.end();\n  }\n\n  function redrawCurrentViewPort(debug) {\n    _data.layout.forceCenterOnCursor = false;\n\n    _data.tasks.process('LayoutOptionsTask', null, debug);\n\n    _data.graphics.end();\n  }\n\n  function onScroll(event) {\n    if (_timer == null) {\n      _timer = window.setTimeout(function () {\n        redrawCurrentViewPort(_debug);\n        window.clearTimeout(_timer);\n        _timer = null;\n      }, 200);\n    }\n  }\n  /**\n   * Call this method to update controls configuration. Control uses default Config instance to initialize itself, \n   * so it sets only options provided in the options parameter.\n   * \n   * @param {object} options Options\n   */\n\n\n  function setOptions(options) {\n    for (var option in options) {\n      if (options.hasOwnProperty(option)) {\n        _data.options[option] = options[option];\n      }\n    }\n  }\n  /**\n   * This method returns current configuration object.\n   * \n   * @returns {object} Returns reference to current configuration object\n   */\n\n\n  function getOptions() {\n    return _data.options;\n  }\n  /**\n   * This method returns configuration option by name.\n   * \n   * @param {*} option Option name\n   */\n\n\n  function getOption(option) {\n    return _data.options[option];\n  }\n  /**\n   * Sets configuration option of the control by name.\n   * \n   * @param {*} option Option name\n   * @param {*} value Option value\n   */\n\n\n  function setOption(option, value) {\n    return _data.options[option] = value;\n  }\n\n  function getGraphics() {\n    return _data.graphics;\n  }\n\n  function getLayout() {\n    var layout = _data.layout,\n        scrollPanelSize = getInnerSize(layout.controlPanel),\n        placeholderOffset = new Point(layout.scrollPanel.scrollLeft, layout.scrollPanel.scrollTop);\n    return {\n      forceCenterOnCursor: layout.forceCenterOnCursor,\n      scrollPanelSize: scrollPanelSize,\n      placeholderOffset: placeholderOffset\n    };\n  }\n\n  function setLayout(layoutOptions) {\n    var layout = _data.layout,\n        pixelAlignmentFix = getFixOfPixelAlignment(layout.element);\n    JsonML.applyStyles(layout.controlPanel, {\n      \"marginLeft\": pixelAlignmentFix.width + \"px\",\n\n      /* fixes div pixel alignment */\n      \"marginTop\": pixelAlignmentFix.height + \"px\"\n    });\n    /* set scroll panel position */\n\n    JsonML.applyStyles(layout.scrollPanel, layoutOptions.scrollPanelRect.getCSS());\n    /* set scaled content panel for tracking mouse events without scaling */\n\n    JsonML.applyStyles(layout.mousePanel, layoutOptions.mousePanelSize.getCSS());\n    /* set size and scale of content panel */\n\n    var scaleText = \"scale(\" + layoutOptions.scale + \",\" + layoutOptions.scale + \")\";\n    var scaleProperties = {\n      \"transform-origin\": \"0 0\",\n      \"transform\": scaleText,\n      \"-ms-transform\": scaleText,\n\n      /* IE 9 */\n      \"-webkit-transform\": scaleText,\n\n      /* Safari and Chrome */\n      \"-o-transform\": scaleText,\n\n      /* Opera */\n      \"-moz-transform\": scaleText\n      /* Firefox */\n\n    };\n    JsonML.applyStyles(layout.placeholder, mergeObjects(scaleProperties, layoutOptions.placeholderSize.getCSS()));\n\n    if (layoutOptions.autoSize) {\n      /* resize element to fit placeholder if control in auto size mode */\n      JsonML.applyStyles(layout.element, layoutOptions.controlSize.getCSS());\n    }\n    /* set titles panel scale and size */\n\n\n    JsonML.applyStyles(layout.titlesMousePanel, layoutOptions.titlesMousePanelRect.getCSS());\n    JsonML.applyStyles(layout.titlesPlaceholder, mergeObjects(scaleProperties, layoutOptions.titlesPlaceholderSize.getCSS()));\n    /* set frame panel scale and size */\n\n    JsonML.applyStyles(layout.frameMousePanel, layoutOptions.frameMousePanelRect.getCSS());\n    JsonML.applyStyles(layout.framePlaceholder, mergeObjects(scaleProperties, layoutOptions.framePlaceholderSize.getCSS()));\n    layout.scrollPanel.setAttribute(\"class\", layoutOptions.scrollPanelRect.left > 0 ? name : \"bp-scrollframe \" + name);\n  }\n\n  function createLayout(layout, name) {\n    var viewportSize = getInnerSize(layout.element),\n        viewportRect = new Rect(0, 0, viewportSize.width, viewportSize.height),\n        pixelAlignmentFix = getFixOfPixelAlignment(element);\n    JsonML.appendDOM(layout.element, JsonML.toHTML([\"div\",\n    /* root control panel */\n    {\n      \"tabindex\": 0,\n      \"style\": {\n        \"position\": \"relative\",\n        \"overflow\": \"hidden\",\n        \"top\": \"0px\",\n        \"left\": \"0px\",\n        \"width\": \"100%\",\n        \"height\": \"100%\",\n        \"padding\": \"0px\",\n        \"marginBottom\": \"0px\",\n        \"marginRight\": \"0px\",\n        \"marginLeft\": pixelAlignmentFix.width + \"px\",\n\n        /* fixes div pixel alignment */\n        \"marginTop\": pixelAlignmentFix.height + \"px\"\n      },\n      \"name\": \"controlPanel\",\n      \"class\": name,\n      \"$\": function $(element) {\n        layout.controlPanel = element;\n      }\n    }, [\"div\",\n    /* frameMousePanel - frame mouse tracking events panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"frameMousePanel\",\n      \"class\": name,\n      \"$\": function $(element) {\n        layout.frameMousePanel = element;\n      }\n    }, [\"div\",\n    /* frameplaceholder - contents scalable panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"framePlaceholder\",\n      \"class\": [\"frameplaceholder\", name],\n      \"$\": function $(element) {\n        layout.framePlaceholder = element;\n      }\n    }]], [\"div\",\n    /* titlesMousePanel - titles mouse tracking events panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"titlesMousePanel\",\n      \"class\": [\"bp-titles-frame\", name],\n      \"$\": function $(element) {\n        layout.titlesMousePanel = element;\n      }\n    }, [\"div\",\n    /* titlesplaceholder - contents scalable panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"titlesPlaceholder\",\n      \"class\": [\"titlesplaceholder\", name],\n      \"$\": function $(element) {\n        layout.titlesPlaceholder = element;\n      }\n    }]], [\"div\",\n    /* scrollPanel - root scroll panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        \"overflow\": \"auto\",\n        \"-webkit-overflow-scrolling\": \"touch\",\n        \"top\": \"0px\",\n        \"left\": \"0px\",\n        \"width\": viewportRect.width + \"px\",\n        \"height\": viewportRect.height + \"px\"\n      }, viewportRect.getCSS()),\n      \"name\": \"scrollPanel\",\n      \"class\": name,\n      \"$\": function $(element) {\n        layout.scrollPanel = element;\n      }\n    }, [\"div\",\n    /* mousePanel - mouse tracking events panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"visible\"\n      }, viewportRect.getCSS()),\n      \"name\": \"mousePanel\",\n      \"class\": name,\n      \"$\": function $(element) {\n        layout.mousePanel = element;\n      }\n    }, [\"div\",\n    /* placeholder - contents scalable panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"placeholder\",\n      \"class\": [\"placeholder\", name],\n      \"$\": function $(element) {\n        layout.placeholder = element;\n      }\n    }, [\"div\",\n    /* calloutPlaceholder - callout panel */\n    {\n      \"style\": {\n        position: \"absolute\",\n        overflow: \"visible\",\n        top: \"0px\",\n        left: \"0px\",\n        width: \"0px\",\n        height: \"0px\"\n      },\n      \"name\": \"calloutPlaceholder\",\n      \"class\": [\"calloutplaceholder\", name],\n      \"$\": function $(element) {\n        layout.calloutPlaceholder = element;\n      }\n    }]]]]]));\n  }\n\n  function cleanLayout() {\n    var controlPanel = _data.layout.controlPanel;\n\n    if (controlPanel != null) {\n      var parent = controlPanel.parentNode;\n\n      if (parent != null) {\n        parent.removeChild(controlPanel);\n      }\n    }\n  }\n\n  function bind(layout) {\n    layout.mousePanel.addEventListener('mousemove', onMouseMove);\n    layout.mousePanel.addEventListener('click', onMouseClick);\n    layout.mousePanel.addEventListener('dblclick', onMouseDblClick);\n    layout.mousePanel.addEventListener('change', onCheckboxChange);\n    layout.element.addEventListener('keydown', onKeyDown);\n    layout.scrollPanel.addEventListener('scroll', onScroll);\n\n    if (_data.options.enablePanning && isChrome()) {\n      layout.scrollPanel.draggable = true;\n      layout.scrollPanel.addEventListener('dragstart', onDragStart);\n      layout.scrollPanel.addEventListener('drag', onDragScroll);\n      layout.scrollPanel.addEventListener('dragend', onDragScroll);\n      layout.scrollPanel.addEventListener('dragover', onDragOver);\n    }\n\n    layout.frameMousePanel.addEventListener('mousemove', onFrameMouseMove);\n    layout.frameMousePanel.addEventListener('click', onFrameMouseClick);\n  }\n\n  function unbind(layout) {\n    if (layout.mousePanel != null) {\n      layout.mousePanel.removeEventListener(\"mousemove\", onMouseMove);\n      layout.mousePanel.removeEventListener(\"click\", onMouseClick);\n      layout.mousePanel.removeEventListener(\"dblclick\", onMouseDblClick);\n      layout.mousePanel.removeEventListener(\"change\", onCheckboxChange);\n    }\n\n    if (layout.element != null) {\n      layout.element.removeEventListener(\"keydown\", onKeyDown);\n    }\n\n    if (layout.scrollPanel != null) {\n      layout.scrollPanel.removeEventListener(\"scroll\", onScroll);\n      layout.scrollPanel.removeEventListener('dragstart', onDragStart);\n      layout.scrollPanel.removeEventListener('drag', onDragScroll);\n      layout.scrollPanel.removeEventListener('dragend', onDragScroll);\n      layout.scrollPanel.removeEventListener('dragover', onDragOver);\n    }\n\n    if (layout.frameMousePanel != null) {\n      layout.frameMousePanel.removeEventListener('mousemove', onFrameMouseMove);\n      layout.frameMousePanel.removeEventListener('click', onFrameMouseClick);\n    }\n  }\n\n  function onFrameMouseMove(event) {\n    var placeholderOffset = getElementOffset(_data.layout.frameMousePanel),\n        x = event.pageX - placeholderOffset.left,\n        y = event.pageY - placeholderOffset.top;\n\n    var projectItemsToFrameTask = _data.tasks.getTask(\"ProjectItemsToFrameTask\"),\n        highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n        itemId;\n\n    if (highlightItemOptionTask.hasHighlightEnabled()) {\n      itemId = projectItemsToFrameTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius());\n      setHighlightItem(event, itemId);\n    }\n  }\n\n  function onFrameMouseClick(event) {\n    var placeholderOffset = getElementOffset(_data.layout.frameMousePanel),\n        x = event.pageX - placeholderOffset.left,\n        y = event.pageY - placeholderOffset.top,\n        projectItemsToFrameTask = _data.tasks.getTask(\"ProjectItemsToFrameTask\"),\n        cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\n        highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n        newCursorItemId = projectItemsToFrameTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius()),\n        target,\n        eventArgs;\n\n    target = event.target;\n\n    if (newCursorItemId !== null) {\n      eventArgs = getEventArgs(null, newCursorItemId);\n      trigger(\"onMouseClick\", event, eventArgs);\n\n      if (!eventArgs.cancel) {\n        if (cursorItemOptionTask.hasCursorEnabled()) {\n          setCursorItem(event, newCursorItemId);\n\n          _data.layout.element.focus();\n        }\n      }\n    }\n  }\n\n  function onMouseMove(event) {\n    var placeholderOffset = getElementOffset(_data.layout.mousePanel),\n        x = event.pageX - placeholderOffset.left,\n        y = event.pageY - placeholderOffset.top,\n        createTransformTask = _data.tasks.getTask(\"CreateTransformTask\"),\n        highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n        itemId;\n\n    if (highlightItemOptionTask.hasHighlightEnabled()) {\n      itemId = createTransformTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius());\n      setHighlightItem(event, itemId);\n    }\n  }\n\n  function onCheckboxChange(event) {\n    var target = event.target;\n    var selectedId = target.getAttribute(\"data-id\");\n\n    if (selectedId != null) {\n      var selectedItems = (_data.options.selectedItems || []).slice();\n      var eventArgs = getEventArgs(null, selectedId);\n      var position = selectedItems.findIndex(function (itemid) {\n        return selectedId === itemid;\n      });\n      trigger(\"onSelectionChanging\", event, eventArgs);\n\n      if (!eventArgs.cancel) {\n        if (position >= 0) {\n          selectedItems.splice(position, 1);\n        } else {\n          selectedItems.push(selectedId);\n        }\n\n        _data.options.selectedItems = selectedItems;\n\n        if (position < 0) {\n          target.setAttribute(\"checked\", \"checked\");\n        } else {\n          target.removeAttribute(\"checked\");\n        } //refresh(false, false);\n\n\n        trigger(\"onSelectionChanged\", event, eventArgs);\n      }\n    }\n  }\n\n  function onMouseClick(event) {\n    var placeholderOffset = getElementOffset(_data.layout.mousePanel),\n        x = event.pageX - placeholderOffset.left,\n        y = event.pageY - placeholderOffset.top,\n        createTransformTask = _data.tasks.getTask(\"CreateTransformTask\"),\n        cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\n        highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n        newCursorItemId = createTransformTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius()),\n        target,\n        buttonName,\n        eventArgs;\n\n    target = event.target;\n\n    if (newCursorItemId !== null) {\n      var buttonName = target.getAttribute(\"data-buttonname\");\n\n      if (isNullOrEmpty(buttonName)) {\n        buttonName = target.parentNode && target.parentNode.getAttribute(\"data-buttonname\");\n      }\n\n      ;\n\n      if (!isNullOrEmpty(buttonName)) {\n        eventArgs = getEventArgs(null, newCursorItemId, buttonName);\n        trigger(\"onButtonClick\", event, eventArgs);\n      } else if (target.getAttribute(\"name\") === \"checkbox\" || target.getAttribute(\"name\") === \"selectiontext\") {//ignore jslint\n      } else {\n        eventArgs = getEventArgs(null, newCursorItemId);\n        trigger(\"onMouseClick\", event, eventArgs);\n\n        if (!eventArgs.cancel) {\n          if (cursorItemOptionTask.hasCursorEnabled()) {\n            setCursorItem(event, newCursorItemId);\n\n            _data.layout.element.focus();\n          }\n        }\n      }\n    }\n  }\n\n  function onMouseDblClick(event) {\n    var eventArgs,\n        highlightItemTask = _data.tasks.getTask(\"HighlightItemTask\"),\n        highlightTreeItem = highlightItemTask.getHighlightTreeItem();\n\n    if (highlightTreeItem !== null) {\n      eventArgs = getEventArgs(null, highlightTreeItem);\n      trigger(\"onMouseDblClick\", event, eventArgs);\n    }\n  }\n\n  function onKeyDown(event) {\n    var highlightItemTask = _data.tasks.getTask(\"HighlightItemTask\"),\n        highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n        cursorItemTask = _data.tasks.getTask(\"CursorItemTask\"),\n        cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\n        alignDiagramTask = _data.tasks.getTask('AlignDiagramTask'),\n        createTransformTask = _data.tasks.getTask('CreateTransformTask'),\n        transform = createTransformTask.getTransform(),\n        navigationItem = null,\n        newNavigationItem,\n        direction = null,\n        accepted,\n        layout = _data.layout;\n\n    if (highlightItemOptionTask.hasHighlightEnabled() && cursorItemOptionTask.hasCursorEnabled()) {\n      navigationItem = highlightItemTask.getHighlightTreeItem();\n\n      if (navigationItem === null) {\n        navigationItem = cursorItemTask.getCursorTreeItem();\n      }\n    } else if (highlightItemOptionTask.hasHighlightEnabled()) {\n      navigationItem = highlightItemTask.getHighlightTreeItem();\n    } else if (cursorItemOptionTask.hasCursorEnabled()) {\n      navigationItem = cursorItemTask.getCursorTreeItem();\n    }\n\n    if (navigationItem != null) {\n      switch (event.which) {\n        case 13:\n          /*Enter*/\n          if (cursorItemOptionTask.hasCursorEnabled()) {\n            setCursorItem(event, navigationItem);\n            event.preventDefault();\n            layout.element.focus();\n          }\n\n          break;\n\n        case 40:\n          /*Down*/\n          direction = OrientationType.Bottom;\n          break;\n\n        case 38:\n          /*Up*/\n          direction = OrientationType.Top;\n          break;\n\n        case 37:\n          /*Left*/\n          direction = OrientationType.Left;\n          break;\n\n        case 39:\n          /*Right*/\n          direction = OrientationType.Right;\n          break;\n      }\n\n      if (direction != null) {\n        accepted = false;\n\n        while (!accepted) {\n          accepted = true;\n          direction = transform.getOrientation(direction);\n          newNavigationItem = alignDiagramTask.getNextItem(navigationItem, direction);\n\n          if (newNavigationItem != null) {\n            event.preventDefault();\n\n            if (highlightItemOptionTask.hasHighlightEnabled()) {\n              setHighlightItem(event, newNavigationItem);\n            } else if (cursorItemOptionTask.hasCursorEnabled()) {\n              setCursorItem(event, newNavigationItem);\n            }\n          }\n        }\n\n        layout.element.focus();\n      }\n    }\n  }\n\n  function onDragStart(event) {\n    var scrollPanel = _data.layout.scrollPanel;\n    _dragFrom = new Point(event.clientX, event.clientY);\n    _scrollFrom = new Point(scrollPanel.scrollLeft, scrollPanel.scrollTop);\n    _dragImage = _dragImage || new Image(); //ignore jslint\n\n    event.dataTransfer.setDragImage(_dragImage, 0, 0);\n  }\n\n  function onDragOver(event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = \"move\";\n  }\n\n  function onDragScroll(event) {\n    _scrollTo = new Point(_scrollFrom.x - (event.clientX - _dragFrom.x), _scrollFrom.y - (event.clientY - _dragFrom.y));\n\n    if (_dragTimer == null) {\n      _dragTimer = window.setTimeout(function () {\n        var scrollPanel = _data.layout.scrollPanel;\n        scrollPanel.scrollLeft = _scrollTo.x;\n        scrollPanel.scrollTop = _scrollTo.y;\n        window.clearTimeout(_dragTimer);\n        _dragTimer = null;\n      }, 50);\n    }\n  }\n\n  function setHighlightItem(event, newHighlightItemId) {\n    var result = true,\n        eventArgs;\n\n    if (newHighlightItemId !== null) {\n      if (newHighlightItemId !== _data.options.highlightItem) {\n        eventArgs = getEventArgs(_data.options.highlightItem, newHighlightItemId);\n        _data.options.highlightItem = newHighlightItemId;\n        trigger(\"onHighlightChanging\", event, eventArgs);\n\n        if (!eventArgs.cancel) {\n          refresh(false, false);\n          trigger(\"onHighlightChanged\", event, eventArgs);\n        } else {\n          result = false;\n        }\n      }\n    } else {\n      if (_data.options.highlightItem !== null) {\n        eventArgs = getEventArgs(_data.options.highlightItem, null);\n        _data.options.highlightItem = null;\n        trigger(\"onHighlightChanging\", event, eventArgs);\n\n        if (!eventArgs.cancel) {\n          refresh(false, false);\n          trigger(\"onHighlightChanged\", event, eventArgs);\n        } else {\n          result = false;\n        }\n      }\n    }\n\n    return result;\n  }\n\n  function setCursorItem(event, newCursorItemId) {\n    var eventArgs;\n\n    if (newCursorItemId !== _data.options.cursorItem) {\n      eventArgs = getEventArgs(_data.options.cursorItem, newCursorItemId);\n      _data.options.cursorItem = newCursorItemId;\n      trigger(\"onCursorChanging\", event, eventArgs);\n\n      if (!eventArgs.cancel) {\n        refresh(true, _debug);\n        trigger(\"onCursorChanged\", event, eventArgs);\n      }\n    }\n  }\n\n  function getEventArgs(oldTreeItemId, newTreeItemId, name) {\n    return eventArgsFactory(_data, oldTreeItemId, newTreeItemId, name);\n  }\n\n  function trigger(eventHandlerName, event, eventArgs) {\n    var eventHandler = _data.options[eventHandlerName];\n\n    if (eventHandler != null) {\n      eventHandler(event, eventArgs);\n    }\n  }\n\n  update();\n  /* init control on create */\n\n  return {\n    destroy: destroy,\n    setOptions: setOptions,\n    getOptions: getOptions,\n    setOption: setOption,\n    getOption: getOption,\n    update: update\n  };\n}\n;","map":{"version":3,"sources":["/Users/01005901/go/src/github.com/Resily/react/node_modules/basicprimitives/src/BaseControl.js"],"names":["Point","Thickness","Rect","UpdateMode","OrientationType","isNullOrEmpty","createGraphics","isChrome","getFixOfPixelAlignment","getInnerSize","getElementOffset","JsonML","mergeObjects","BaseControl","element","options","taskManagerFactory","eventArgsFactory","templates","_data","name","tasks","graphics","mouse","layout","controlPanel","frameMousePanel","framePlaceholder","titlesMousePanel","titlesPlaceholder","scrollPanel","mousePanel","placeholder","calloutPlaceholder","forceCenterOnCursor","_dragFrom","_scrollFrom","_scrollTo","_dragImage","_dragTimer","_debug","_timer","update","updateMode","Refresh","refresh","PositonHighlight","positionHighlight","redraw","destroy","unbind","cleanLayout","createLayout","bind","getOptions","getGraphics","getLayout","setLayout","graphicsType","debug","centerOnCursorTask","placeholderOffset","process","end","getTask","getPlaceholderOffset","scrollLeft","x","scrollTop","y","pixelAlignmentFix","applyStyles","width","height","redrawCurrentViewPort","onScroll","event","window","setTimeout","clearTimeout","setOptions","option","hasOwnProperty","getOption","setOption","value","scrollPanelSize","layoutOptions","scrollPanelRect","getCSS","mousePanelSize","scaleText","scale","scaleProperties","placeholderSize","autoSize","controlSize","titlesMousePanelRect","titlesPlaceholderSize","frameMousePanelRect","framePlaceholderSize","setAttribute","left","viewportSize","viewportRect","appendDOM","toHTML","position","overflow","top","parent","parentNode","removeChild","addEventListener","onMouseMove","onMouseClick","onMouseDblClick","onCheckboxChange","onKeyDown","enablePanning","draggable","onDragStart","onDragScroll","onDragOver","onFrameMouseMove","onFrameMouseClick","removeEventListener","pageX","pageY","projectItemsToFrameTask","highlightItemOptionTask","itemId","hasHighlightEnabled","getTreeItemForMousePosition","getGravityRadius","setHighlightItem","cursorItemOptionTask","newCursorItemId","target","eventArgs","getEventArgs","trigger","cancel","hasCursorEnabled","setCursorItem","focus","createTransformTask","selectedId","getAttribute","selectedItems","slice","findIndex","itemid","splice","push","removeAttribute","buttonName","highlightItemTask","highlightTreeItem","getHighlightTreeItem","cursorItemTask","alignDiagramTask","transform","getTransform","navigationItem","newNavigationItem","direction","accepted","getCursorTreeItem","which","preventDefault","Bottom","Top","Left","Right","getOrientation","getNextItem","clientX","clientY","Image","dataTransfer","setDragImage","dropEffect","newHighlightItemId","result","highlightItem","cursorItem","oldTreeItemId","newTreeItemId","eventHandlerName","eventHandler"],"mappings":"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","sourcesContent":["import Point from './graphics/structs/Point';\nimport Thickness from './graphics/structs/Thickness';\nimport Rect from './graphics/structs/Rect';\nimport { UpdateMode, OrientationType } from './enums';\nimport { isNullOrEmpty } from './common';\nimport createGraphics, { isChrome } from './graphics/createGraphics';\nimport { getFixOfPixelAlignment, getInnerSize, getElementOffset } from './graphics/dom';\nimport JsonML from './common/jsonml-html';\nimport { mergeObjects } from './common';\n\n/**\n * JavaScript Abstract Control\n * @class BaseControl\n */\nexport default function BaseControl(element, options, taskManagerFactory, eventArgsFactory, templates) {\n  var _data = {\n    name: \"orgdiagram\",\n    options: options,\n    tasks: null,\n    graphics: null,\n    mouse: null,\n    layout: {\n      element: element,\n      controlPanel: null,\n      frameMousePanel: null,\n      framePlaceholder: null,\n      titlesMousePanel: null,\n      titlesPlaceholder: null,\n      scrollPanel: null,\n      mousePanel: null,\n      placeholder: null,\n      calloutPlaceholder: null,\n      forceCenterOnCursor: true\n    }\n  },\n    _dragFrom,\n    _scrollFrom,\n    _scrollTo,\n    _dragImage,\n    _dragTimer,\n    _debug = false,\n    _timer = null;\n\n  /**\n   * Performs full redraw of the diagram contents via reevaluating all API options. This method has to be called explicitly\n   * after all options are set in order to update controls contents.\n   * \n   * @param {UpdateMode} updateMode \n   * @param {boolean} forceCenterOnCursor \n   */\n  function update(updateMode, forceCenterOnCursor) {\n    if (forceCenterOnCursor == null) {\n      forceCenterOnCursor = true;\n    }\n    switch (updateMode) {\n      case UpdateMode.Refresh:\n        refresh(forceCenterOnCursor, _debug);\n        break;\n      case UpdateMode.PositonHighlight:\n        positionHighlight(_debug);\n        break;\n      default:\n        redraw();\n        break;\n    }\n  }\n\n  /**\n   * Removes all elements control added to DOM including event listeners.\n   */\n  function destroy() {\n    unbind(_data.layout);\n    cleanLayout(_data.layout);\n\n    _data.tasks = null;\n    _data.graphics = null;\n  }\n\n  function redraw() {\n    unbind(_data.layout);\n    cleanLayout(_data.layout);\n\n    createLayout(_data.layout, _data.name);\n    bind(_data.layout);\n    _data.tasks = taskManagerFactory(getOptions, getGraphics, getLayout, setLayout, templates);\n    _data.graphics = createGraphics(_data.options.graphicsType, _data.layout.element);\n    _data.graphics.debug = _debug;\n\n    refresh(true, _debug);\n  }\n\n  function refresh(forceCenterOnCursor, debug) {\n    var centerOnCursorTask,\n      placeholderOffset;\n\n    //_data.layout.scrollPanel.css({\n    //  \"display\": \"none\",\n    //  \"-webkit-overflow-scrolling\": \"auto\"\n    //});\n\n    //this.graphics.begin();\n\n    _data.layout.forceCenterOnCursor = forceCenterOnCursor;\n    _data.tasks.process('OptionsTask', null, debug);\n\n    _data.graphics.end();\n\n    //_data.layout.scrollPanel.css({\n    //  \"display\": \"block\"\n    //});\n\n    if (forceCenterOnCursor) {\n      /* scroll to offset */\n      centerOnCursorTask = _data.tasks.getTask(\"CenterOnCursorTask\");\n      placeholderOffset = centerOnCursorTask.getPlaceholderOffset();\n      _data.layout.scrollPanel.scrollLeft = placeholderOffset.x;\n      _data.layout.scrollPanel.scrollTop = placeholderOffset.y;\n    }\n    //_data.layout.scrollPanel.css({\n    //  \"-webkit-overflow-scrolling\": \"touch\"\n    //});\n\n    /* fix pixel alignment */\n    var pixelAlignmentFix = getFixOfPixelAlignment(_data.layout.element);\n    JsonML.applyStyles(_data.layout.scrollPanel, {\n      \"marginBottom\": \"0px\",\n      \"marginRight\": \"0px\",\n      \"marginLeft\": pixelAlignmentFix.width + \"px\", /* fixes div pixel alignment */\n      \"marginTop\": pixelAlignmentFix.height + \"px\"\n    });\n  }\n\n  function positionHighlight(debug) {\n    _data.layout.forceCenterOnCursor = false;\n    _data.tasks.process('HighlightItemOptionTask', null, debug);\n\n    _data.graphics.end();\n  }\n\n  function redrawCurrentViewPort(debug) {\n    _data.layout.forceCenterOnCursor = false;\n    _data.tasks.process('LayoutOptionsTask', null, debug);\n\n    _data.graphics.end();\n  }\n\n  function onScroll(event) {\n    if (_timer == null) {\n      _timer = window.setTimeout(function () {\n        redrawCurrentViewPort(_debug);\n        window.clearTimeout(_timer);\n        _timer = null;\n      }, 200);\n    }\n  }\n\n  /**\n   * Call this method to update controls configuration. Control uses default Config instance to initialize itself, \n   * so it sets only options provided in the options parameter.\n   * \n   * @param {object} options Options\n   */\n  function setOptions(options) {\n    for (var option in options) {\n      if (options.hasOwnProperty(option)) {\n        _data.options[option] = options[option];\n      }\n    }\n  }\n\n  /**\n   * This method returns current configuration object.\n   * \n   * @returns {object} Returns reference to current configuration object\n   */\n  function getOptions() {\n    return _data.options;\n  }\n\n  /**\n   * This method returns configuration option by name.\n   * \n   * @param {*} option Option name\n   */\n  function getOption(option) {\n    return _data.options[option];\n  }\n\n  /**\n   * Sets configuration option of the control by name.\n   * \n   * @param {*} option Option name\n   * @param {*} value Option value\n   */\n  function setOption(option, value) {\n    return _data.options[option] = value;\n  }\n\n  function getGraphics() {\n    return _data.graphics;\n  }\n\n  function getLayout() {\n    var layout = _data.layout,\n      scrollPanelSize = getInnerSize(layout.controlPanel),\n      placeholderOffset = new Point(layout.scrollPanel.scrollLeft, layout.scrollPanel.scrollTop);\n    return {\n      forceCenterOnCursor: layout.forceCenterOnCursor,\n      scrollPanelSize: scrollPanelSize,\n      placeholderOffset: placeholderOffset\n    }\n  }\n\n  function setLayout(layoutOptions) {\n    var layout = _data.layout,\n      pixelAlignmentFix = getFixOfPixelAlignment(layout.element);\n\n    JsonML.applyStyles(layout.controlPanel, {\n      \"marginLeft\": pixelAlignmentFix.width + \"px\", /* fixes div pixel alignment */\n      \"marginTop\": pixelAlignmentFix.height + \"px\"\n    });\n\n    /* set scroll panel position */\n    JsonML.applyStyles(layout.scrollPanel, layoutOptions.scrollPanelRect.getCSS());\n\n    /* set scaled content panel for tracking mouse events without scaling */\n    JsonML.applyStyles(layout.mousePanel, layoutOptions.mousePanelSize.getCSS());\n\n    /* set size and scale of content panel */\n    var scaleText = \"scale(\" + layoutOptions.scale + \",\" + layoutOptions.scale + \")\";\n    var scaleProperties = {\n      \"transform-origin\": \"0 0\",\n      \"transform\": scaleText,\n      \"-ms-transform\": scaleText, /* IE 9 */\n      \"-webkit-transform\": scaleText, /* Safari and Chrome */\n      \"-o-transform\": scaleText, /* Opera */\n      \"-moz-transform\": scaleText /* Firefox */\n    };\n    JsonML.applyStyles(layout.placeholder, mergeObjects(scaleProperties, layoutOptions.placeholderSize.getCSS()));\n\n    if (layoutOptions.autoSize) {\n      /* resize element to fit placeholder if control in auto size mode */\n      JsonML.applyStyles(layout.element, layoutOptions.controlSize.getCSS());\n    }\n\n    /* set titles panel scale and size */\n    JsonML.applyStyles(layout.titlesMousePanel, layoutOptions.titlesMousePanelRect.getCSS());\n    JsonML.applyStyles(layout.titlesPlaceholder, mergeObjects(scaleProperties, layoutOptions.titlesPlaceholderSize.getCSS()));\n\n    /* set frame panel scale and size */\n    JsonML.applyStyles(layout.frameMousePanel, layoutOptions.frameMousePanelRect.getCSS());\n    JsonML.applyStyles(layout.framePlaceholder, mergeObjects(scaleProperties, layoutOptions.framePlaceholderSize.getCSS()));\n    \n    layout.scrollPanel.setAttribute(\"class\", layoutOptions.scrollPanelRect.left > 0 ? name : \"bp-scrollframe \" + name);\n  }\n\n  function createLayout(layout, name) {\n    var viewportSize = getInnerSize(layout.element),\n      viewportRect = new Rect(0, 0, viewportSize.width, viewportSize.height),\n      pixelAlignmentFix = getFixOfPixelAlignment(element);\n\n\n    JsonML.appendDOM(layout.element, JsonML.toHTML(\n      [\"div\", /* root control panel */\n        {\n          \"tabindex\": 0,\n          \"style\": {\n            \"position\": \"relative\",\n            \"overflow\": \"hidden\",\n            \"top\": \"0px\",\n            \"left\": \"0px\",\n            \"width\": \"100%\",\n            \"height\": \"100%\",\n            \"padding\": \"0px\",\n            \"marginBottom\": \"0px\",\n            \"marginRight\": \"0px\",\n            \"marginLeft\": pixelAlignmentFix.width + \"px\", /* fixes div pixel alignment */\n            \"marginTop\": pixelAlignmentFix.height + \"px\"\n          },\n          \"name\": \"controlPanel\",\n          \"class\": name,\n          \"$\": function (element) { layout.controlPanel = element; }\n        },\n        [\"div\", /* frameMousePanel - frame mouse tracking events panel */\n          {\n            \"style\": mergeObjects({\n              position: \"absolute\",\n              overflow: \"hidden\"\n            },\n              viewportRect.getCSS()),\n            \"name\": \"frameMousePanel\",\n            \"class\": name,\n            \"$\": function (element) { layout.frameMousePanel = element; }\n          },\n          [\"div\", /* frameplaceholder - contents scalable panel */\n            {\n              \"style\": mergeObjects({\n                position: \"absolute\",\n                overflow: \"hidden\"\n              },\n                viewportRect.getCSS()),\n              \"name\": \"framePlaceholder\",\n              \"class\": [\"frameplaceholder\", name],\n              \"$\": function (element) { layout.framePlaceholder = element; }\n            }\n          ]\n        ],\n        [\"div\", /* titlesMousePanel - titles mouse tracking events panel */\n          {\n            \"style\": mergeObjects({\n              position: \"absolute\",\n              overflow: \"hidden\"\n            },\n              viewportRect.getCSS()),\n            \"name\": \"titlesMousePanel\",\n            \"class\": [\"bp-titles-frame\", name],\n            \"$\": function (element) { layout.titlesMousePanel = element; }\n          },\n          [\"div\", /* titlesplaceholder - contents scalable panel */\n            {\n              \"style\": mergeObjects({\n                position: \"absolute\",\n                overflow: \"hidden\"\n              },\n                viewportRect.getCSS()),\n              \"name\": \"titlesPlaceholder\",\n              \"class\": [\"titlesplaceholder\", name],\n              \"$\": function (element) { layout.titlesPlaceholder = element; }\n            }\n          ]\n        ],\n        [\"div\", /* scrollPanel - root scroll panel */\n          {\n            \"style\": mergeObjects({\n              position: \"absolute\",\n              \"overflow\": \"auto\",\n              \"-webkit-overflow-scrolling\": \"touch\",\n              \"top\": \"0px\",\n              \"left\": \"0px\",\n              \"width\": viewportRect.width + \"px\",\n              \"height\": viewportRect.height + \"px\"\n            },\n              viewportRect.getCSS()),\n            \"name\": \"scrollPanel\",\n            \"class\": name,\n            \"$\": function (element) { layout.scrollPanel = element; }\n          },\n          [\"div\", /* mousePanel - mouse tracking events panel */\n            {\n              \"style\": mergeObjects({\n                position: \"absolute\",\n                overflow: \"visible\"\n              },\n                viewportRect.getCSS()),\n              \"name\": \"mousePanel\",\n              \"class\": name,\n              \"$\": function (element) { layout.mousePanel = element; }\n            },\n            [\"div\", /* placeholder - contents scalable panel */\n              {\n                \"style\": mergeObjects({\n                  position: \"absolute\",\n                  overflow: \"hidden\"\n                },\n                  viewportRect.getCSS()),\n                \"name\": \"placeholder\",\n                \"class\": [\"placeholder\", name],\n                \"$\": function (element) { layout.placeholder = element; }\n              },\n              [\"div\", /* calloutPlaceholder - callout panel */\n                {\n                  \"style\": {\n                    position: \"absolute\",\n                    overflow: \"visible\",\n                    top: \"0px\",\n                    left: \"0px\",\n                    width: \"0px\",\n                    height: \"0px\"\n                  },\n                  \"name\": \"calloutPlaceholder\",\n                  \"class\": [\"calloutplaceholder\", name],\n                  \"$\": function (element) { layout.calloutPlaceholder = element; }\n                }\n              ]\n            ]\n          ]\n        ]\n      ])\n    );\n  }\n\n  function cleanLayout() {\n    var controlPanel = _data.layout.controlPanel;\n    if (controlPanel != null) {\n      var parent = controlPanel.parentNode;\n      if (parent != null) {\n        parent.removeChild(controlPanel);\n      }\n    }\n  }\n\n  function bind(layout) {\n    layout.mousePanel.addEventListener('mousemove', onMouseMove);\n    layout.mousePanel.addEventListener('click', onMouseClick);\n    layout.mousePanel.addEventListener('dblclick', onMouseDblClick);\n    layout.mousePanel.addEventListener('change', onCheckboxChange);\n\n    layout.element.addEventListener('keydown', onKeyDown);\n\n    layout.scrollPanel.addEventListener('scroll', onScroll);\n\n    if (_data.options.enablePanning && isChrome()) {\n      layout.scrollPanel.draggable = true;\n      layout.scrollPanel.addEventListener('dragstart', onDragStart);\n      layout.scrollPanel.addEventListener('drag', onDragScroll);\n      layout.scrollPanel.addEventListener('dragend', onDragScroll);\n      layout.scrollPanel.addEventListener('dragover', onDragOver);\n    }\n\n    layout.frameMousePanel.addEventListener('mousemove', onFrameMouseMove);\n    layout.frameMousePanel.addEventListener('click', onFrameMouseClick);\n  }\n\n  function unbind(layout) {\n    if (layout.mousePanel != null) {\n      layout.mousePanel.removeEventListener(\"mousemove\", onMouseMove);\n      layout.mousePanel.removeEventListener(\"click\", onMouseClick);\n      layout.mousePanel.removeEventListener(\"dblclick\", onMouseDblClick);\n      layout.mousePanel.removeEventListener(\"change\", onCheckboxChange);\n    }\n    if (layout.element != null) {\n      layout.element.removeEventListener(\"keydown\", onKeyDown);\n    }\n    if (layout.scrollPanel != null) {\n      layout.scrollPanel.removeEventListener(\"scroll\", onScroll);\n      layout.scrollPanel.removeEventListener('dragstart', onDragStart);\n      layout.scrollPanel.removeEventListener('drag', onDragScroll);\n      layout.scrollPanel.removeEventListener('dragend', onDragScroll);\n      layout.scrollPanel.removeEventListener('dragover', onDragOver);\n    }\n\n    if (layout.frameMousePanel != null) {\n      layout.frameMousePanel.removeEventListener('mousemove', onFrameMouseMove);\n      layout.frameMousePanel.removeEventListener('click', onFrameMouseClick);\n    }\n  }\n\n  function onFrameMouseMove(event) {\n    var placeholderOffset = getElementOffset(_data.layout.frameMousePanel),\n      x = event.pageX - placeholderOffset.left,\n      y = event.pageY - placeholderOffset.top;\n    var projectItemsToFrameTask = _data.tasks.getTask(\"ProjectItemsToFrameTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      itemId;\n\n    if (highlightItemOptionTask.hasHighlightEnabled()) {\n      itemId = projectItemsToFrameTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius());\n      setHighlightItem(event, itemId);\n    }\n  }\n\n  function onFrameMouseClick(event) {\n    var placeholderOffset = getElementOffset(_data.layout.frameMousePanel),\n      x = event.pageX - placeholderOffset.left,\n      y = event.pageY - placeholderOffset.top,\n      projectItemsToFrameTask = _data.tasks.getTask(\"ProjectItemsToFrameTask\"),\n      cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      newCursorItemId = projectItemsToFrameTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius()),\n      target,\n      eventArgs;\n    target = event.target;\n    if (newCursorItemId !== null) {\n      eventArgs = getEventArgs(null, newCursorItemId);\n      trigger(\"onMouseClick\", event, eventArgs);\n      if (!eventArgs.cancel) {\n        if (cursorItemOptionTask.hasCursorEnabled()) {\n          setCursorItem(event, newCursorItemId);\n          _data.layout.element.focus();\n        }\n      }\n    }\n  }\n\n  function onMouseMove(event) {\n    var placeholderOffset = getElementOffset(_data.layout.mousePanel),\n      x = event.pageX - placeholderOffset.left,\n      y = event.pageY - placeholderOffset.top,\n      createTransformTask = _data.tasks.getTask(\"CreateTransformTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      itemId;\n\n    if (highlightItemOptionTask.hasHighlightEnabled()) {\n      itemId = createTransformTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius());\n      setHighlightItem(event, itemId);\n    }\n  }\n\n  function onCheckboxChange(event) {\n    var target = event.target;\n    var selectedId = target.getAttribute(\"data-id\");\n    if (selectedId != null) {\n      var selectedItems = (_data.options.selectedItems || []).slice();\n      var eventArgs = getEventArgs(null, selectedId);\n      var position = selectedItems.findIndex(function(itemid) { return selectedId === itemid});\n      trigger(\"onSelectionChanging\", event, eventArgs);\n      if (!eventArgs.cancel) {\n        if (position >= 0) {\n          selectedItems.splice(position, 1);\n        }\n        else {\n          selectedItems.push(selectedId);\n        }\n        _data.options.selectedItems = selectedItems;\n\n        if (position < 0) {\n          target.setAttribute(\"checked\", \"checked\");\n        } else {\n          target.removeAttribute(\"checked\");\n        }\n\n        //refresh(false, false);\n\n        trigger(\"onSelectionChanged\", event, eventArgs);\n      }\n    }\n  }\n\n  function onMouseClick(event) {\n    var placeholderOffset = getElementOffset(_data.layout.mousePanel),\n      x = event.pageX - placeholderOffset.left,\n      y = event.pageY - placeholderOffset.top,\n      createTransformTask = _data.tasks.getTask(\"CreateTransformTask\"),\n      cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      newCursorItemId = createTransformTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius()),\n      target,\n      buttonName,\n      eventArgs;\n    target = event.target;\n    if (newCursorItemId !== null) {\n      var buttonName = target.getAttribute(\"data-buttonname\");\n      if(isNullOrEmpty(buttonName)) {\n        buttonName = target.parentNode && target.parentNode.getAttribute(\"data-buttonname\");\n      };\n      if (!isNullOrEmpty(buttonName)) {\n        eventArgs = getEventArgs(null, newCursorItemId, buttonName);\n        trigger(\"onButtonClick\", event, eventArgs);\n      }\n      else if (target.getAttribute(\"name\") === \"checkbox\" || target.getAttribute(\"name\") === \"selectiontext\") { //ignore jslint\n\n      }\n      else {\n        eventArgs = getEventArgs(null, newCursorItemId);\n        trigger(\"onMouseClick\", event, eventArgs);\n        if (!eventArgs.cancel) {\n          if (cursorItemOptionTask.hasCursorEnabled()) {\n            setCursorItem(event, newCursorItemId);\n            _data.layout.element.focus();\n          }\n        }\n      }\n    }\n  }\n\n  function onMouseDblClick(event) {\n    var eventArgs,\n      highlightItemTask = _data.tasks.getTask(\"HighlightItemTask\"),\n      highlightTreeItem = highlightItemTask.getHighlightTreeItem();\n\n    if (highlightTreeItem !== null) {\n      eventArgs = getEventArgs(null, highlightTreeItem);\n      trigger(\"onMouseDblClick\", event, eventArgs);\n    }\n  }\n\n  function onKeyDown(event) {\n    var highlightItemTask = _data.tasks.getTask(\"HighlightItemTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      cursorItemTask = _data.tasks.getTask(\"CursorItemTask\"),\n      cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\n      alignDiagramTask = _data.tasks.getTask('AlignDiagramTask'),\n      createTransformTask = _data.tasks.getTask('CreateTransformTask'),\n      transform = createTransformTask.getTransform(),\n      navigationItem = null,\n      newNavigationItem,\n      direction = null,\n      accepted,\n      layout = _data.layout;\n\n    if (highlightItemOptionTask.hasHighlightEnabled() && cursorItemOptionTask.hasCursorEnabled()) {\n      navigationItem = highlightItemTask.getHighlightTreeItem();\n      if (navigationItem === null) {\n        navigationItem = cursorItemTask.getCursorTreeItem();\n      }\n    } else if (highlightItemOptionTask.hasHighlightEnabled()) {\n      navigationItem = highlightItemTask.getHighlightTreeItem();\n    } else if (cursorItemOptionTask.hasCursorEnabled()) {\n      navigationItem = cursorItemTask.getCursorTreeItem();\n    }\n\n\n    if (navigationItem != null) {\n      switch (event.which) {\n        case 13: /*Enter*/\n          if (cursorItemOptionTask.hasCursorEnabled()) {\n            setCursorItem(event, navigationItem);\n            event.preventDefault();\n            layout.element.focus();\n          }\n          break;\n        case 40: /*Down*/\n          direction = OrientationType.Bottom;\n          break;\n        case 38: /*Up*/\n          direction = OrientationType.Top;\n          break;\n        case 37: /*Left*/\n          direction = OrientationType.Left;\n          break;\n        case 39: /*Right*/\n          direction = OrientationType.Right;\n          break;\n      }\n\n      if (direction != null) {\n\n        accepted = false;\n\n        while (!accepted) {\n          accepted = true;\n\n          direction = transform.getOrientation(direction);\n          newNavigationItem = alignDiagramTask.getNextItem(navigationItem, direction);\n\n          if (newNavigationItem != null) {\n            event.preventDefault();\n            if (highlightItemOptionTask.hasHighlightEnabled()) {\n              setHighlightItem(event, newNavigationItem);\n            } else if (cursorItemOptionTask.hasCursorEnabled()) {\n              setCursorItem(event, newNavigationItem);\n            }\n\n          }\n        }\n        layout.element.focus();\n      }\n    }\n  }\n\n  function onDragStart(event) {\n    var scrollPanel = _data.layout.scrollPanel;\n    _dragFrom = new Point(event.clientX, event.clientY);\n    _scrollFrom = new Point(scrollPanel.scrollLeft, scrollPanel.scrollTop);\n    _dragImage = _dragImage || new Image(); //ignore jslint\n    event.dataTransfer.setDragImage(_dragImage, 0, 0);\n  }\n\n  function onDragOver(event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = \"move\";\n  }\n\n  function onDragScroll(event) {\n    _scrollTo = new Point(_scrollFrom.x - (event.clientX - _dragFrom.x), _scrollFrom.y - (event.clientY - _dragFrom.y));\n    if (_dragTimer == null) {\n      _dragTimer = window.setTimeout(function () {\n        var scrollPanel = _data.layout.scrollPanel;\n        scrollPanel.scrollLeft = _scrollTo.x;\n        scrollPanel.scrollTop = _scrollTo.y;\n        window.clearTimeout(_dragTimer);\n        _dragTimer = null;\n      }, 50);\n    }\n  }\n\n  function setHighlightItem(event, newHighlightItemId) {\n    var result = true,\n      eventArgs;\n    if (newHighlightItemId !== null) {\n      if (newHighlightItemId !== _data.options.highlightItem) {\n        eventArgs = getEventArgs(_data.options.highlightItem, newHighlightItemId);\n\n        _data.options.highlightItem = newHighlightItemId;\n\n        trigger(\"onHighlightChanging\", event, eventArgs);\n\n        if (!eventArgs.cancel) {\n          refresh(false, false);\n\n          trigger(\"onHighlightChanged\", event, eventArgs);\n        } else {\n          result = false;\n        }\n      }\n    } else {\n      if (_data.options.highlightItem !== null) {\n        eventArgs = getEventArgs(_data.options.highlightItem, null);\n\n        _data.options.highlightItem = null;\n\n        trigger(\"onHighlightChanging\", event, eventArgs);\n\n        if (!eventArgs.cancel) {\n          refresh(false, false);\n\n          trigger(\"onHighlightChanged\", event, eventArgs);\n        } else {\n          result = false;\n        }\n      }\n    }\n    return result;\n  }\n\n  function setCursorItem(event, newCursorItemId) {\n    var eventArgs;\n    if (newCursorItemId !== _data.options.cursorItem) {\n      eventArgs = getEventArgs(_data.options.cursorItem, newCursorItemId);\n\n      _data.options.cursorItem = newCursorItemId;\n\n      trigger(\"onCursorChanging\", event, eventArgs);\n\n      if (!eventArgs.cancel) {\n        refresh(true, _debug);\n\n        trigger(\"onCursorChanged\", event, eventArgs);\n      }\n    }\n  }\n\n  function getEventArgs(oldTreeItemId, newTreeItemId, name) {\n    return eventArgsFactory(_data, oldTreeItemId, newTreeItemId, name);\n  }\n\n  function trigger(eventHandlerName, event, eventArgs) {\n    var eventHandler = _data.options[eventHandlerName];\n    if (eventHandler != null) {\n      eventHandler(event, eventArgs);\n    }\n  }\n\n  update(); /* init control on create */\n\n  return {\n    destroy: destroy,\n    setOptions: setOptions,\n    getOptions: getOptions,\n    setOption: setOption,\n    getOption: getOption,\n    update: update\n  };\n};\n"]},"metadata":{},"sourceType":"module"}