{"ast":null,"code":"import { isNullOrEmpty } from '../common';\nexport default function ArrayReader(itemTemplate, containsUniqueItems, uniquePropertyKey, createSourceHash, isOrdered) {\n  this.itemTemplate = itemTemplate;\n  this.containsUniqueItems = containsUniqueItems;\n  this.uniquePropertyKey = uniquePropertyKey;\n  this.containsPrimitiveValues = isNullOrEmpty(uniquePropertyKey);\n  this.createSourceHash = createSourceHash;\n  this.isOrdered = isOrdered;\n}\n;\n\nArrayReader.prototype.read = function (target, source, path, context) {\n  var result = [],\n      resultHash = {},\n      hash,\n      sequence,\n      resultSequence = {},\n      sourceHash = {},\n      item,\n      itemid,\n      index,\n      len,\n      newHashObject,\n      sequencePath = path + \"-seq\";\n  /* validate source array */\n\n  if (!source || !Array.isArray(source)) {\n    source = [];\n  }\n  /* hash values for tracking changes */\n\n\n  hash = context.hash.hasOwnProperty(path) ? context.hash[path] : {};\n  sequence = context.hash.hasOwnProperty(sequencePath) ? context.hash[sequencePath] : {};\n\n  for (index = 0, len = source.length; index < len; index += 1) {\n    item = source[index];\n    itemid = this.containsUniqueItems ? this.containsPrimitiveValues ? item : item[this.uniquePropertyKey] : index;\n\n    if (!resultHash.hasOwnProperty(itemid)) {\n      newHashObject = this.itemTemplate.read(hash.hasOwnProperty(itemid) ? hash[itemid] : {}, item, path + \"-\" + index, context);\n      result.push(newHashObject);\n      resultHash[itemid] = newHashObject;\n      resultSequence[index] = itemid;\n\n      if (this.createSourceHash) {\n        sourceHash[itemid] = item;\n      }\n\n      if (this.isOrdered) {\n        if (sequence[index] != resultSequence[index]) {\n          context.isChanged = true;\n        }\n      }\n    }\n  }\n\n  context.hash[path] = resultHash;\n  context.hash[sequencePath] = resultSequence;\n\n  if (this.createSourceHash) {\n    context.sourceHash[path] = sourceHash;\n  }\n\n  if (target == null || target.length != result.length) {\n    context.isChanged = true;\n  }\n\n  return result;\n};","map":{"version":3,"sources":["/Users/01005901/go/src/github.com/Resily/react/node_modules/basicprimitives/src/readers/ArrayReader.js"],"names":["isNullOrEmpty","ArrayReader","itemTemplate","containsUniqueItems","uniquePropertyKey","createSourceHash","isOrdered","containsPrimitiveValues","prototype","read","target","source","path","context","result","resultHash","hash","sequence","resultSequence","sourceHash","item","itemid","index","len","newHashObject","sequencePath","Array","isArray","hasOwnProperty","length","push","isChanged"],"mappings":"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","sourcesContent":["import {isNullOrEmpty} from '../common';\n\nexport default function ArrayReader(itemTemplate, containsUniqueItems, uniquePropertyKey, createSourceHash, isOrdered) {\n  this.itemTemplate = itemTemplate;\n  this.containsUniqueItems = containsUniqueItems;\n  this.uniquePropertyKey = uniquePropertyKey;\n  this.containsPrimitiveValues = isNullOrEmpty(uniquePropertyKey);\n  this.createSourceHash = createSourceHash;\n  this.isOrdered = isOrdered;\n};\n\nArrayReader.prototype.read = function (target, source, path, context) {\n  var result = [], resultHash = {},\n    hash, sequence, resultSequence = {},\n    sourceHash = {},\n    item, itemid,\n    index, len,\n    newHashObject,\n    sequencePath = path + \"-seq\";\n\n  /* validate source array */\n  if (!source || !Array.isArray(source)) {\n    source = [];\n  }\n\n  /* hash values for tracking changes */\n  hash = context.hash.hasOwnProperty(path) ? context.hash[path] : {};\n  sequence = context.hash.hasOwnProperty(sequencePath) ? context.hash[sequencePath] : {};\n\n  for (index = 0, len = source.length; index < len; index += 1) {\n    item = source[index];\n\n    itemid = this.containsUniqueItems ? (this.containsPrimitiveValues ? item : item[this.uniquePropertyKey]) : index;\n\n    if (!resultHash.hasOwnProperty(itemid)) {\n      newHashObject = this.itemTemplate.read(hash.hasOwnProperty(itemid) ? hash[itemid] : {}, item, path + \"-\" + index, context);\n\n      result.push(newHashObject);\n      resultHash[itemid] = newHashObject;\n      resultSequence[index] = itemid;\n      if (this.createSourceHash) {\n        sourceHash[itemid] = item;\n      }\n\n      if (this.isOrdered) {\n        if (sequence[index] != resultSequence[index]) {\n          context.isChanged = true;\n        }\n      }\n    }\n  }\n\n  context.hash[path] = resultHash;\n  context.hash[sequencePath] = resultSequence;\n  if (this.createSourceHash) {\n    context.sourceHash[path] = sourceHash;\n  }\n\n  if (target == null || target.length != result.length) {\n    context.isChanged = true;\n  }\n\n  return result;\n};"]},"metadata":{},"sourceType":"module"}