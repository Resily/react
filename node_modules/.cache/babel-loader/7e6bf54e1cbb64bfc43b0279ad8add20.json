{"ast":null,"code":"import Cache from './Cache';\nimport { Layers } from '../enums';\nimport { loop, getHashCode, mergeObjects } from '../common';\nimport { TextOrientationType, VerticalAlignmentType, SegmentType, RenderingMode } from '../enums';\nimport JsonML from '../common/jsonml-html';\nimport Size from './structs/Size';\nimport Rect from './structs/Rect';\nimport Placeholder from './Placeholder';\nimport Layer from './Layer';\nimport { getInnerSize } from './dom';\nimport RenderEventArgs from '../events/RenderEventArgs';\nimport { getTextAlign, getVerticalAlignment } from './EnumValues';\nexport default function Graphics(element) {\n  this.m_element = element;\n  this.m_placeholders = {};\n  this.m_activePlaceholder = null;\n  this.m_cache = new Cache();\n  this.graphicsType = null;\n  this.hasGraphics = false;\n  this.debug = false;\n  this.layerNames = {};\n  loop(this, Layers, function (key, value) {\n    this.layerNames[value] = key;\n  });\n}\n;\n\nGraphics.prototype.clean = function () {\n  var key, placeholder, layerKey, layer;\n  this.m_cache.clear();\n  this.m_cache = null;\n  this.m_element = null;\n\n  for (key in this.m_placeholders) {\n    if (this.m_placeholders.hasOwnProperty(key)) {\n      placeholder = this.m_placeholders[key];\n\n      for (layerKey in placeholder.layers) {\n        if (placeholder.layers.hasOwnProperty(layerKey)) {\n          layer = placeholder.layers[layerKey];\n          layer.canvas.parentNode.removeChild(layer.canvas);\n          layer.canvas = null;\n        }\n      }\n\n      placeholder.layers.length = 0;\n      placeholder.activeLayer = null;\n      placeholder.size = null;\n      placeholder.rect = null;\n      placeholder.div = null;\n    }\n  }\n\n  this.m_placeholders.length = 0;\n  this.m_activePlaceholder = null;\n};\n\nGraphics.prototype.resize = function (name, width, height) {\n  var placeholder = this.m_placeholders[name];\n\n  if (placeholder === undefined) {\n    placeholder = this._activatePlaceholder(name);\n  }\n\n  this.resizePlaceholder(placeholder, 0, 0, width, height);\n};\n\nGraphics.prototype.position = function (name, left, top, width, height) {\n  var placeholder = this.m_placeholders[name];\n\n  if (placeholder === undefined) {\n    placeholder = this._activatePlaceholder(name);\n  }\n\n  this.resizePlaceholder(placeholder, left, top, width, height);\n};\n\nGraphics.prototype.show = function (name) {\n  var placeholder = this.m_placeholders[name];\n\n  if (placeholder != null) {\n    JsonML.applyStyles(placeholder.div, {\n      display: \"inherit\",\n      visibility: \"inherit\"\n    });\n  }\n};\n\nGraphics.prototype.hide = function (name) {\n  var placeholder = this.m_placeholders[name];\n\n  if (placeholder != null) {\n    JsonML.applyStyles(placeholder.div, {\n      \"display\": \"none\",\n      \"visibility\": \"hidden\"\n    });\n  }\n};\n\nGraphics.prototype.resizePlaceholder = function (placeholder, left, top, width, height) {\n  var layerKey, layer;\n  placeholder.size = new Size(width, height);\n  placeholder.rect = new Rect(left, top, width, height);\n  JsonML.applyStyles(placeholder.div, placeholder.rect.getCSS());\n\n  for (layerKey in placeholder.layers) {\n    if (placeholder.layers.hasOwnProperty(layerKey)) {\n      layer = placeholder.layers[layerKey];\n\n      if (layer.name !== -1) {\n        JsonML.applyStyles(layer.canvas, {\n          \"position\": \"absolute\",\n          \"width\": \"0px\",\n          \"height\": \"0px\"\n        });\n      }\n    }\n  }\n};\n\nGraphics.prototype.begin = function () {\n  this.m_cache.begin();\n};\n\nGraphics.prototype.end = function () {\n  this.m_cache.end();\n};\n\nGraphics.prototype.reset = function (arg0, arg1) {\n  var placeholderName = \"none\",\n      layerName = -1;\n\n  switch (arguments.length) {\n    case 1:\n      if (typeof arg0 === \"string\") {\n        placeholderName = arg0;\n      } else {\n        layerName = arg0;\n      }\n\n      break;\n\n    case 2:\n      placeholderName = arg0;\n      layerName = arg1;\n      break;\n  }\n\n  this.m_cache.reset(placeholderName, layerName);\n};\n\nGraphics.prototype.activate = function (arg0, arg1) {\n  switch (arguments.length) {\n    case 1:\n      if (typeof arg0 === \"string\") {\n        this._activatePlaceholder(arg0);\n\n        this._activateLayer(-1);\n      } else {\n        this._activatePlaceholder(\"none\");\n\n        this._activateLayer(arg0);\n      }\n\n      break;\n\n    case 2:\n      this._activatePlaceholder(arg0);\n\n      this._activateLayer(arg1);\n\n      break;\n  }\n\n  return this.m_activePlaceholder;\n};\n\nGraphics.prototype._activatePlaceholder = function (placeholderName) {\n  var placeholder = this.m_placeholders[placeholderName],\n      div,\n      divs;\n\n  if (placeholder === undefined) {\n    div = null;\n\n    if (placeholderName === \"none\") {\n      div = this.m_element;\n    } else {\n      divs = this.m_element.getElementsByClassName(placeholderName);\n      div = divs.length > 0 ? divs[0] : this.m_element;\n    }\n\n    placeholder = new Placeholder(placeholderName);\n    placeholder.div = div;\n    placeholder.size = getInnerSize(div);\n    placeholder.rect = new Rect(0, 0, placeholder.size.width, placeholder.size.height);\n    this.m_placeholders[placeholderName] = placeholder;\n  }\n\n  this.m_activePlaceholder = placeholder;\n  return this.m_activePlaceholder;\n};\n\nGraphics.prototype._activateLayer = function (layerName) {\n  var layer = this.m_activePlaceholder.layers[layerName],\n      placeholder,\n      canvas,\n      position,\n      maximumLayer,\n      layerKey;\n\n  if (layer === undefined) {\n    placeholder = this.m_activePlaceholder;\n\n    if (layerName === -1) {\n      layer = new Layer(layerName);\n      layer.canvas = placeholder.div;\n    } else {\n      canvas = JsonML.toHTML([\"div\", {\n        \"style\": {\n          \"position\": \"absolute\",\n          \"width\": \"0px\",\n          \"height\": \"0px\"\n        },\n        \"class\": [\"Layer\" + layerName, \"Layer\" + this.layerNames[layerName]]\n      }]);\n      maximumLayer = null;\n\n      for (layerKey in placeholder.layers) {\n        if (placeholder.layers.hasOwnProperty(layerKey)) {\n          layer = placeholder.layers[layerKey];\n\n          if (layer.name < layerName) {\n            maximumLayer = maximumLayer !== null ? Math.max(maximumLayer, layer.name) : layer.name;\n          }\n        }\n      }\n\n      layer = new Layer(layerName);\n      layer.canvas = canvas;\n\n      if (maximumLayer === null) {\n        this.prepend(placeholder.div, layer.canvas);\n      } else {\n        this.insertAfter(placeholder.layers[maximumLayer].canvas, layer.canvas);\n      }\n    }\n\n    placeholder.layers[layerName] = layer;\n  }\n\n  this.m_activePlaceholder.activeLayer = layer;\n};\n\nGraphics.prototype.prepend = function (parent, newElement) {\n  if (parent.firstChild == null) {\n    parent.appendChild(newElement);\n  } else {\n    parent.insertBefore(newElement, parent.firstChild);\n  }\n};\n\nGraphics.prototype.insertAfter = function (insertAfterElement, newElement) {\n  var parent = insertAfterElement.parentNode;\n\n  if (parent.lastChild == insertAfterElement) {\n    parent.appendChild(newElement);\n  } else {\n    parent.insertBefore(newElement, insertAfterElement.nextSibling);\n  }\n};\n\nGraphics.prototype.text = function (x, y, width, height, label, orientation, horizontalAlignment, verticalAlignment, attr) {\n  var placeholder = this.m_activePlaceholder,\n      style = {\n    \"position\": \"absolute\",\n    \"padding\": 0,\n    \"margin\": 0,\n    \"textAlign\": getTextAlign(horizontalAlignment),\n    \"fontSize\": attr.fontSize,\n    \"fontFamily\": attr.fontFamily,\n    \"fontWeight\": attr.fontWeight,\n    \"fontStyle\": attr.fontStyle,\n    \"color\": attr.fontColor,\n    \"lineHeight\": 1\n  },\n      rotation = \"\",\n      element,\n      tdstyle;\n\n  switch (orientation) {\n    case TextOrientationType.Horizontal:\n    case TextOrientationType.Auto:\n      style.left = x + \"px\";\n      style.top = y + \"px\";\n      style.width = width + \"px\";\n      style.height = height + \"px\";\n      break;\n\n    case TextOrientationType.RotateLeft:\n      style.left = x + Math.round(width / 2.0 - height / 2.0) + \"px\";\n      style.top = y + Math.round(height / 2.0 - width / 2.0) + \"px\";\n      style.width = height + \"px\";\n      style.height = width + \"px\";\n      rotation = \"rotate(-90deg)\";\n      break;\n\n    case TextOrientationType.RotateRight:\n      style.left = x + Math.round(width / 2.0 - height / 2.0) + \"px\";\n      style.top = y + Math.round(height / 2.0 - width / 2.0) + \"px\";\n      style.width = height + \"px\";\n      style.height = width + \"px\";\n      rotation = \"rotate(90deg)\";\n      break;\n  }\n\n  style[\"-webkit-transform-origin\"] = \"center center\";\n  style[\"-moz-transform-origin\"] = \"center center\";\n  style[\"-o-transform-origin\"] = \"center center\";\n  style[\"-ms-transform-origin\"] = \"center center\";\n  style[\"-webkit-transform\"] = rotation;\n  style[\"-moz-transform\"] = rotation;\n  style[\"-o-transform\"] = rotation;\n  style[\"-ms-transform\"] = rotation;\n  style.transform = rotation;\n  style.maxWidth = style.width;\n  style.maxHeight = style.height;\n  label = label.replace(new RegExp(\"\\n\", 'g'), \"<br/>\");\n\n  switch (verticalAlignment) {\n    case VerticalAlignmentType.Top:\n      if (this.debug) {\n        style.border = \"solid 1px black\";\n      }\n\n      element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, \"text\");\n\n      if (element === null) {\n        element = JsonML.toHTML([\"div\", {\n          \"style\": style,\n          $: function $(element) {\n            element.innerHTML = label;\n          }\n        }]);\n        placeholder.activeLayer.canvas.appendChild(element);\n        this.m_cache.put(placeholder.name, placeholder.activeLayer.name, \"text\", element);\n      } else {\n        JsonML.applyStyles(element, style);\n        element.innerHTML = label;\n      }\n\n      break;\n\n    default:\n      style.borderCollapse = \"collapse\";\n      tdstyle = {\n        \"verticalAlign\": getVerticalAlignment(verticalAlignment),\n        \"padding\": 0\n      };\n\n      if (this.debug) {\n        tdstyle.border = \"solid 1px black\";\n      }\n\n      element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, \"textintable\");\n\n      if (element === null) {\n        element = JsonML.toHTML([\"table\", {\n          \"style\": style\n        }, [\"tbody\", [\"tr\", [\"td\", {\n          \"style\": tdstyle,\n          $: function $(element) {\n            element.innerHTML = label;\n          }\n        }]]]]);\n        placeholder.activeLayer.canvas.appendChild(element);\n        this.m_cache.put(placeholder.name, placeholder.activeLayer.name, \"textintable\", element);\n      } else {\n        JsonML.applyStyles(element, style);\n        var td = element.getElementsByTagName(\"td\")[0];\n        JsonML.applyStyles(td, tdstyle);\n        td.innerHTML = label;\n      }\n\n      break;\n  }\n};\n\nGraphics.prototype.polylinesBuffer = function (buffer) {\n  buffer.loop(this, function (polyline) {\n    if (polyline.length() > 0) {\n      this.polyline(polyline);\n    }\n  });\n};\n\nGraphics.prototype.polyline = function (polylineData) {\n  var fromX = null,\n      fromY = null,\n      attr = polylineData.paletteItem.toAttr();\n  polylineData.loop(this, function (segment) {\n    switch (segment.segmentType) {\n      case SegmentType.Move:\n        fromX = Math.round(segment.x) + 0.5;\n        fromY = Math.round(segment.y) + 0.5;\n        break;\n\n      case SegmentType.Line:\n        this.rightAngleLine(fromX, fromY, Math.round(segment.x) + 0.5, Math.round(segment.y) + 0.5, attr);\n        fromX = Math.round(segment.x) + 0.5;\n        fromY = Math.round(segment.y) + 0.5;\n        break;\n\n      case SegmentType.Dot:\n        this.dot(segment.x, segment.y, segment.width, segment.height, segment.cornerRadius, attr);\n        break;\n    }\n  });\n};\n\nGraphics.prototype.dot = function (cx, cy, width, height, cornerRadius, attr) {\n  var placeholder = this.m_activePlaceholder,\n      element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, \"dot\"),\n      hasBorder = attr.lineWidth !== undefined && attr.borderColor !== undefined,\n      style = {\n    \"position\": \"absolute\",\n    \"width\": width - (hasBorder ? 1 : 0),\n    \"top\": Math.round(cy),\n    \"left\": Math.round(cx),\n    \"padding\": 0,\n    \"margin\": 0,\n    \"lineHeight\": \"0px\",\n    \"overflow\": \"hidden\",\n    \"height\": height - (hasBorder ? 1 : 0),\n    \"background\": attr.fillColor,\n    \"MozBorderRadius\": cornerRadius,\n    \"WebkitBorderRadius\": cornerRadius,\n    \"-khtml-border-radius\": cornerRadius,\n    \"borderRadius\": cornerRadius,\n    \"fontSize\": \"0px\",\n    \"borderStyle\": hasBorder ? \"Solid\" : \"None\",\n    \"borderWidth\": hasBorder ? \"1px\" : \"0px\",\n    \"borderColor\": hasBorder ? attr.borderColor : \"\"\n  };\n\n  if (element === null) {\n    element = JsonML.toHTML([\"div\", {\n      \"style\": style\n    }]);\n    placeholder.activeLayer.canvas.appendChild(element);\n    this.m_cache.put(placeholder.name, placeholder.activeLayer.name, \"dot\", element);\n  } else {\n    JsonML.applyStyles(element, style);\n  }\n};\n\nGraphics.prototype.rightAngleLine = function (fromX, fromY, toX, toY, attr) {\n  var placeholder = this.m_activePlaceholder,\n      isVertical = Math.abs(toY - fromY) > Math.abs(toX - fromX),\n      lineWidth = attr.lineWidth,\n      style = {\n    \"position\": \"absolute\",\n    \"top\": Math.round(Math.min(fromY, toY) - (isVertical ? 0 : lineWidth / 2.0)),\n    \"left\": Math.round(Math.min(fromX, toX) - (isVertical ? lineWidth / 2.0 : 0)),\n    \"padding\": 0,\n    \"margin\": 0,\n    \"opacity\": 0.5,\n    \"lineHeight\": \"0px\",\n    \"overflow\": \"hidden\",\n    \"background\": attr.borderColor,\n    \"fontSize\": \"0px\"\n  },\n      element;\n\n  if (isVertical) {\n    style.width = lineWidth;\n    style.height = Math.abs(Math.round(toY - fromY));\n  } else {\n    style.width = Math.abs(Math.round(toX - fromX));\n    style.height = lineWidth;\n  }\n\n  element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, \"rect\");\n\n  if (element === null) {\n    element = JsonML.toHTML([\"div\", {\n      \"style\": style\n    }]);\n    placeholder.activeLayer.canvas.appendChild(element);\n    this.m_cache.put(placeholder.name, placeholder.activeLayer.name, \"rect\", element);\n  } else {\n    JsonML.applyStyles(element, style);\n  }\n};\n\nGraphics.prototype.template = function (x, y, width, height, contentx, contenty, contentWidth, contentHeight, template, hashCode, onRenderTemplate, uiHash, attr) {\n  //ignore jslint\n  var placeholder = this.m_activePlaceholder,\n      element,\n      templateKey = \"template\" + (hashCode !== null ? hashCode : getHashCode(template)),\n      gap = 0,\n      style;\n  element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, templateKey);\n\n  if (attr !== null) {\n    if (attr.borderWidth !== undefined) {\n      attr.borderWidth = attr.borderWidth.toString();\n      gap = this.getPxSize(attr.borderWidth);\n    }\n  }\n\n  style = {\n    \"width\": contentWidth - gap + \"px\",\n    \"height\": contentHeight - gap + \"px\",\n    \"top\": y + contenty + \"px\",\n    \"left\": x + contentx + \"px\"\n  };\n  mergeObjects(style, attr);\n\n  if (uiHash == null) {\n    uiHash = new RenderEventArgs();\n  }\n\n  uiHash.x = x + contentx;\n  uiHash.y = y + contenty;\n  uiHash.width = contentWidth - gap;\n  uiHash.height = contentHeight - gap;\n\n  if (element == null) {\n    element = this.getElementByTemplate(template);\n    style = mergeObjects(style, {\n      \"position\": \"absolute\",\n      \"padding\": \"0px\",\n      \"margin\": \"0px\"\n    }, attr);\n    JsonML.applyStyles(element, style);\n    uiHash.element = element;\n    uiHash.renderingMode = RenderingMode.Create;\n\n    if (onRenderTemplate !== null) {\n      onRenderTemplate(null, uiHash);\n    }\n\n    placeholder.activeLayer.canvas.appendChild(element);\n    this.m_cache.put(placeholder.name, placeholder.activeLayer.name, templateKey, element);\n  } else {\n    uiHash.element = element;\n    uiHash.renderingMode = RenderingMode.Update;\n    JsonML.applyStyles(element, style);\n\n    if (onRenderTemplate !== null) {\n      onRenderTemplate(null, uiHash);\n    }\n  }\n\n  return element;\n};\n\nGraphics.prototype.getElementByTemplate = function (template) {\n  var result = null;\n\n  if (Array.isArray(template)) {\n    result = JsonML.toHTML(template);\n  } else {\n    var parent = document.createElement('div');\n    parent.innerHTML = template;\n    result = parent.firstChild;\n  }\n\n  return result;\n};\n\nGraphics.prototype.getPxSize = function (value, base) {\n  var result = value;\n\n  if (typeof value === \"string\") {\n    if (value.indexOf(\"pt\") > 0) {\n      result = parseInt(value, 10) * 96 / 72;\n    } else if (value.indexOf(\"%\") > 0) {\n      result = parseFloat(value) / 100.0 * base;\n    } else {\n      result = parseInt(value, 10);\n    }\n  }\n\n  return result;\n};","map":{"version":3,"sources":["/Users/01005901/go/src/github.com/Resily/react/node_modules/basicprimitives/src/graphics/Graphics.js"],"names":["Cache","Layers","loop","getHashCode","mergeObjects","TextOrientationType","VerticalAlignmentType","SegmentType","RenderingMode","JsonML","Size","Rect","Placeholder","Layer","getInnerSize","RenderEventArgs","getTextAlign","getVerticalAlignment","Graphics","element","m_element","m_placeholders","m_activePlaceholder","m_cache","graphicsType","hasGraphics","debug","layerNames","key","value","prototype","clean","placeholder","layerKey","layer","clear","hasOwnProperty","layers","canvas","parentNode","removeChild","length","activeLayer","size","rect","div","resize","name","width","height","undefined","_activatePlaceholder","resizePlaceholder","position","left","top","show","applyStyles","display","visibility","hide","getCSS","begin","end","reset","arg0","arg1","placeholderName","layerName","arguments","activate","_activateLayer","divs","getElementsByClassName","maximumLayer","toHTML","Math","max","prepend","insertAfter","parent","newElement","firstChild","appendChild","insertBefore","insertAfterElement","lastChild","nextSibling","text","x","y","label","orientation","horizontalAlignment","verticalAlignment","attr","style","fontSize","fontFamily","fontWeight","fontStyle","fontColor","rotation","tdstyle","Horizontal","Auto","RotateLeft","round","RotateRight","transform","maxWidth","maxHeight","replace","RegExp","Top","border","get","$","innerHTML","put","borderCollapse","td","getElementsByTagName","polylinesBuffer","buffer","polyline","polylineData","fromX","fromY","paletteItem","toAttr","segment","segmentType","Move","Line","rightAngleLine","Dot","dot","cornerRadius","cx","cy","hasBorder","lineWidth","borderColor","fillColor","toX","toY","isVertical","abs","min","template","contentx","contenty","contentWidth","contentHeight","hashCode","onRenderTemplate","uiHash","templateKey","gap","borderWidth","toString","getPxSize","getElementByTemplate","renderingMode","Create","Update","result","Array","isArray","document","createElement","base","indexOf","parseInt","parseFloat"],"mappings":"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","sourcesContent":["import Cache from './Cache';\nimport { Layers } from '../enums';\nimport { loop, getHashCode, mergeObjects } from '../common';\nimport { TextOrientationType, VerticalAlignmentType, SegmentType, RenderingMode } from '../enums';\nimport JsonML from '../common/jsonml-html';\nimport Size from './structs/Size';\nimport Rect from './structs/Rect';\nimport Placeholder from './Placeholder';\nimport Layer from './Layer';\nimport { getInnerSize } from './dom';\nimport RenderEventArgs from '../events/RenderEventArgs';\nimport { getTextAlign, getVerticalAlignment } from './EnumValues';\n\nexport default function Graphics(element) {\n  this.m_element = element;\n\n  this.m_placeholders = {};\n  this.m_activePlaceholder = null;\n\n  this.m_cache = new Cache();\n\n  this.graphicsType = null;\n  this.hasGraphics = false;\n  this.debug = false;\n  this.layerNames = {};\n\n  loop(this, Layers, function (key, value) {\n    this.layerNames[value] = key;\n  });\n};\n\nGraphics.prototype.clean = function () {\n  var key,\n    placeholder,\n    layerKey,\n    layer;\n  this.m_cache.clear();\n\n  this.m_cache = null;\n\n  this.m_element = null;\n  for (key in this.m_placeholders) {\n    if (this.m_placeholders.hasOwnProperty(key)) {\n      placeholder = this.m_placeholders[key];\n\n      for (layerKey in placeholder.layers) {\n        if (placeholder.layers.hasOwnProperty(layerKey)) {\n          layer = placeholder.layers[layerKey];\n          layer.canvas.parentNode.removeChild(layer.canvas);\n          layer.canvas = null;\n        }\n      }\n      placeholder.layers.length = 0;\n      placeholder.activeLayer = null;\n\n      placeholder.size = null;\n      placeholder.rect = null;\n      placeholder.div = null;\n    }\n  }\n  this.m_placeholders.length = 0;\n  this.m_activePlaceholder = null;\n};\n\nGraphics.prototype.resize = function (name, width, height) {\n  var placeholder = this.m_placeholders[name];\n  if (placeholder === undefined) {\n    placeholder = this._activatePlaceholder(name);\n  }\n  this.resizePlaceholder(placeholder, 0, 0, width, height);\n};\n\nGraphics.prototype.position = function (name, left, top, width, height) {\n  var placeholder = this.m_placeholders[name];\n  if (placeholder === undefined) {\n    placeholder = this._activatePlaceholder(name);\n  }\n  this.resizePlaceholder(placeholder, left, top, width, height);\n};\n\nGraphics.prototype.show = function (name) {\n  var placeholder = this.m_placeholders[name];\n  if (placeholder != null) {\n    JsonML.applyStyles(placeholder.div, {\n      display: \"inherit\",\n      visibility: \"inherit\"\n    });\n  }\n};\n\nGraphics.prototype.hide = function (name) {\n  var placeholder = this.m_placeholders[name];\n  if (placeholder != null) {\n    JsonML.applyStyles(placeholder.div, {\n      \"display\": \"none\",\n      \"visibility\": \"hidden\"\n    });\n  }\n};\n\nGraphics.prototype.resizePlaceholder = function (placeholder, left, top, width, height) {\n  var layerKey,\n    layer;\n\n  placeholder.size = new Size(width, height);\n  placeholder.rect = new Rect(left, top, width, height);\n\n  JsonML.applyStyles(placeholder.div, placeholder.rect.getCSS());\n  for (layerKey in placeholder.layers) {\n    if (placeholder.layers.hasOwnProperty(layerKey)) {\n      layer = placeholder.layers[layerKey];\n      if (layer.name !== -1) {\n        JsonML.applyStyles(layer.canvas, {\n          \"position\": \"absolute\",\n          \"width\": \"0px\",\n          \"height\": \"0px\"\n        });\n      }\n    }\n  }\n};\n\nGraphics.prototype.begin = function () {\n  this.m_cache.begin();\n};\n\nGraphics.prototype.end = function () {\n  this.m_cache.end();\n};\n\n\nGraphics.prototype.reset = function (arg0, arg1) {\n  var placeholderName = \"none\",\n    layerName = -1;\n  switch (arguments.length) {\n    case 1:\n      if (typeof arg0 === \"string\") {\n        placeholderName = arg0;\n      }\n      else {\n        layerName = arg0;\n      }\n      break;\n    case 2:\n      placeholderName = arg0;\n      layerName = arg1;\n      break;\n  }\n  this.m_cache.reset(placeholderName, layerName);\n};\n\nGraphics.prototype.activate = function (arg0, arg1) {\n  switch (arguments.length) {\n    case 1:\n      if (typeof arg0 === \"string\") {\n        this._activatePlaceholder(arg0);\n        this._activateLayer(-1);\n      }\n      else {\n        this._activatePlaceholder(\"none\");\n        this._activateLayer(arg0);\n      }\n      break;\n    case 2:\n      this._activatePlaceholder(arg0);\n      this._activateLayer(arg1);\n      break;\n  }\n  return this.m_activePlaceholder;\n};\n\nGraphics.prototype._activatePlaceholder = function (placeholderName) {\n  var placeholder = this.m_placeholders[placeholderName],\n    div, divs;\n  if (placeholder === undefined) {\n    div = null;\n    if (placeholderName === \"none\") {\n      div = this.m_element;\n    }\n    else {\n      divs = this.m_element.getElementsByClassName(placeholderName);\n      div = divs.length > 0 ? divs[0] : this.m_element;\n    }\n\n    placeholder = new Placeholder(placeholderName);\n    placeholder.div = div;\n    placeholder.size = getInnerSize(div);\n    placeholder.rect = new Rect(0, 0, placeholder.size.width, placeholder.size.height);\n\n    this.m_placeholders[placeholderName] = placeholder;\n  }\n  this.m_activePlaceholder = placeholder;\n  return this.m_activePlaceholder;\n};\n\nGraphics.prototype._activateLayer = function (layerName) {\n  var layer = this.m_activePlaceholder.layers[layerName],\n    placeholder,\n    canvas,\n    position,\n    maximumLayer,\n    layerKey;\n  if (layer === undefined) {\n    placeholder = this.m_activePlaceholder;\n    if (layerName === -1) {\n      layer = new Layer(layerName);\n      layer.canvas = placeholder.div;\n    }\n    else {\n      canvas = JsonML.toHTML([\"div\",\n        {\n          \"style\": {\n            \"position\": \"absolute\",\n            \"width\": \"0px\",\n            \"height\": \"0px\"\n          },\n          \"class\": [\"Layer\" + layerName, \"Layer\" + this.layerNames[layerName]]\n        }\n      ]);\n\n      maximumLayer = null;\n      for (layerKey in placeholder.layers) {\n        if (placeholder.layers.hasOwnProperty(layerKey)) {\n          layer = placeholder.layers[layerKey];\n          if (layer.name < layerName) {\n            maximumLayer = (maximumLayer !== null) ? Math.max(maximumLayer, layer.name) : layer.name;\n          }\n        }\n      }\n\n      layer = new Layer(layerName);\n      layer.canvas = canvas;\n\n      if (maximumLayer === null) {\n        this.prepend(placeholder.div, layer.canvas);\n      } else {\n        this.insertAfter(placeholder.layers[maximumLayer].canvas, layer.canvas);\n      }\n    }\n    placeholder.layers[layerName] = layer;\n  }\n  this.m_activePlaceholder.activeLayer = layer;\n};\n\nGraphics.prototype.prepend = function (parent, newElement) {\n  if (parent.firstChild == null) {\n    parent.appendChild(newElement);\n  } else {\n    parent.insertBefore(newElement, parent.firstChild);\n  }\n};\n\nGraphics.prototype.insertAfter = function (insertAfterElement, newElement) {\n  var parent = insertAfterElement.parentNode;\n  if (parent.lastChild == insertAfterElement) {\n    parent.appendChild(newElement);\n  } else {\n    parent.insertBefore(newElement, insertAfterElement.nextSibling);\n  }\n};\n\nGraphics.prototype.text = function (x, y, width, height, label, orientation, horizontalAlignment, verticalAlignment, attr) {\n  var placeholder = this.m_activePlaceholder,\n    style = {\n      \"position\": \"absolute\",\n      \"padding\": 0,\n      \"margin\": 0,\n      \"textAlign\": getTextAlign(horizontalAlignment),\n      \"fontSize\": attr.fontSize,\n      \"fontFamily\": attr.fontFamily,\n      \"fontWeight\": attr.fontWeight,\n      \"fontStyle\": attr.fontStyle,\n      \"color\": attr.fontColor,\n      \"lineHeight\": 1\n    },\n    rotation = \"\",\n    element,\n    tdstyle;\n\n  switch (orientation) {\n    case TextOrientationType.Horizontal:\n    case TextOrientationType.Auto:\n      style.left = x + \"px\";\n      style.top = y + \"px\";\n      style.width = width + \"px\";\n      style.height = height + \"px\";\n      break;\n    case TextOrientationType.RotateLeft:\n      style.left = x + Math.round(width / 2.0 - height / 2.0) + \"px\";\n      style.top = y + Math.round(height / 2.0 - width / 2.0) + \"px\";\n      style.width = height + \"px\";\n      style.height = width + \"px\";\n      rotation = \"rotate(-90deg)\";\n      break;\n    case TextOrientationType.RotateRight:\n      style.left = x + Math.round(width / 2.0 - height / 2.0) + \"px\";\n      style.top = y + Math.round(height / 2.0 - width / 2.0) + \"px\";\n      style.width = height + \"px\";\n      style.height = width + \"px\";\n      rotation = \"rotate(90deg)\";\n      break;\n  }\n\n  style[\"-webkit-transform-origin\"] = \"center center\";\n  style[\"-moz-transform-origin\"] = \"center center\";\n  style[\"-o-transform-origin\"] = \"center center\";\n  style[\"-ms-transform-origin\"] = \"center center\";\n\n\n  style[\"-webkit-transform\"] = rotation;\n  style[\"-moz-transform\"] = rotation;\n  style[\"-o-transform\"] = rotation;\n  style[\"-ms-transform\"] = rotation;\n  style.transform = rotation;\n\n\n  style.maxWidth = style.width;\n  style.maxHeight = style.height;\n\n  label = label.replace(new RegExp(\"\\n\", 'g'), \"<br/>\");\n  switch (verticalAlignment) {\n    case VerticalAlignmentType.Top:\n      if (this.debug) {\n        style.border = \"solid 1px black\";\n      }\n      element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, \"text\");\n      if (element === null) {\n        element = JsonML.toHTML([\"div\",\n          {\n            \"style\": style,\n            $: function (element) { element.innerHTML = label; }\n          }\n        ]);\n        placeholder.activeLayer.canvas.appendChild(element);\n        this.m_cache.put(placeholder.name, placeholder.activeLayer.name, \"text\", element);\n      }\n      else {\n        JsonML.applyStyles(element, style);\n        element.innerHTML = label;\n      }\n      break;\n    default:\n      style.borderCollapse = \"collapse\";\n      tdstyle = {\n        \"verticalAlign\": getVerticalAlignment(verticalAlignment),\n        \"padding\": 0\n      };\n      if (this.debug) {\n        tdstyle.border = \"solid 1px black\";\n      }\n      element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, \"textintable\");\n      if (element === null) {\n        element = JsonML.toHTML([\"table\",\n          {\n            \"style\": style\n          },\n          [\"tbody\",\n            [\"tr\",\n              [\"td\",\n                {\n                  \"style\": tdstyle,\n                  $: function (element) { element.innerHTML = label; }\n                }\n              ]\n            ]\n          ]\n        ]);\n        placeholder.activeLayer.canvas.appendChild(element);\n        this.m_cache.put(placeholder.name, placeholder.activeLayer.name, \"textintable\", element);\n      }\n      else {\n        JsonML.applyStyles(element, style);\n        var td = element.getElementsByTagName(\"td\")[0];\n        JsonML.applyStyles(td, tdstyle);\n        td.innerHTML = label;\n      }\n      break;\n  }\n};\n\nGraphics.prototype.polylinesBuffer = function (buffer) {\n  buffer.loop(this, function (polyline) {\n    if (polyline.length() > 0) {\n      this.polyline(polyline);\n    }\n  });\n};\n\nGraphics.prototype.polyline = function (polylineData) {\n  var fromX = null,\n    fromY = null,\n    attr = polylineData.paletteItem.toAttr();\n\n  polylineData.loop(this, function (segment) {\n    switch (segment.segmentType) {\n      case SegmentType.Move:\n        fromX = Math.round(segment.x) + 0.5;\n        fromY = Math.round(segment.y) + 0.5;\n        break;\n      case SegmentType.Line:\n        this.rightAngleLine(fromX, fromY, Math.round(segment.x) + 0.5, Math.round(segment.y) + 0.5, attr);\n        fromX = Math.round(segment.x) + 0.5;\n        fromY = Math.round(segment.y) + 0.5;\n        break;\n      case SegmentType.Dot:\n        this.dot(segment.x, segment.y, segment.width, segment.height, segment.cornerRadius, attr);\n        break;\n    }\n  });\n};\n\nGraphics.prototype.dot = function (cx, cy, width, height, cornerRadius, attr) {\n  var placeholder = this.m_activePlaceholder,\n    element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, \"dot\"),\n    hasBorder = (attr.lineWidth !== undefined && attr.borderColor !== undefined),\n    style = {\n      \"position\": \"absolute\",\n      \"width\": (width - (hasBorder ? 1 : 0)),\n      \"top\": Math.round(cy),\n      \"left\": Math.round(cx),\n      \"padding\": 0,\n      \"margin\": 0,\n      \"lineHeight\": \"0px\",\n      \"overflow\": \"hidden\",\n      \"height\": (height - (hasBorder ? 1 : 0)),\n      \"background\": attr.fillColor,\n      \"MozBorderRadius\": cornerRadius,\n      \"WebkitBorderRadius\": cornerRadius,\n      \"-khtml-border-radius\": cornerRadius,\n      \"borderRadius\": cornerRadius,\n      \"fontSize\": \"0px\",\n      \"borderStyle\": (hasBorder ? \"Solid\" : \"None\"),\n      \"borderWidth\": (hasBorder ? \"1px\" : \"0px\"),\n      \"borderColor\": (hasBorder ? attr.borderColor : \"\")\n    };\n\n  if (element === null) {\n    element = JsonML.toHTML([\"div\",\n      {\n        \"style\": style\n      }\n    ]);\n    placeholder.activeLayer.canvas.appendChild(element);\n    this.m_cache.put(placeholder.name, placeholder.activeLayer.name, \"dot\", element);\n  } else {\n    JsonML.applyStyles(element, style);\n  }\n};\n\nGraphics.prototype.rightAngleLine = function (fromX, fromY, toX, toY, attr) {\n  var placeholder = this.m_activePlaceholder,\n    isVertical = Math.abs(toY - fromY) > Math.abs(toX - fromX),\n    lineWidth = attr.lineWidth,\n    style = {\n      \"position\": \"absolute\",\n      \"top\": Math.round(Math.min(fromY, toY) - ((isVertical) ? 0 : lineWidth / 2.0)),\n      \"left\": Math.round(Math.min(fromX, toX) - ((isVertical) ? lineWidth / 2.0 : 0)),\n      \"padding\": 0,\n      \"margin\": 0,\n      \"opacity\": 0.5,\n      \"lineHeight\": \"0px\",\n      \"overflow\": \"hidden\",\n      \"background\": attr.borderColor,\n      \"fontSize\": \"0px\"\n    },\n    element;\n\n  if (isVertical) {\n    style.width = lineWidth;\n    style.height = Math.abs(Math.round(toY - fromY));\n  } else {\n    style.width = Math.abs(Math.round(toX - fromX));\n    style.height = lineWidth;\n  }\n\n  element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, \"rect\");\n  if (element === null) {\n    element = JsonML.toHTML([\"div\",\n      {\n        \"style\": style\n      }\n    ]);\n    placeholder.activeLayer.canvas.appendChild(element);\n    this.m_cache.put(placeholder.name, placeholder.activeLayer.name, \"rect\", element);\n  } else {\n    JsonML.applyStyles(element, style);\n  }\n};\n\nGraphics.prototype.template = function (x, y, width, height, contentx, contenty, contentWidth, contentHeight, template, hashCode, onRenderTemplate, uiHash, attr) { //ignore jslint\n  var placeholder = this.m_activePlaceholder,\n    element,\n    templateKey = \"template\" + ((hashCode !== null) ? hashCode : getHashCode(template)),\n    gap = 0,\n    style;\n\n  element = this.m_cache.get(placeholder.name, placeholder.activeLayer.name, templateKey);\n\n  if (attr !== null) {\n    if (attr.borderWidth !== undefined) {\n      attr.borderWidth = attr.borderWidth.toString();\n      gap = this.getPxSize(attr.borderWidth);\n    }\n  }\n\n  style = {\n    \"width\": (contentWidth - gap) + \"px\",\n    \"height\": (contentHeight - gap) + \"px\",\n    \"top\": (y + contenty) + \"px\",\n    \"left\": (x + contentx) + \"px\"\n  };\n\n  mergeObjects(style, attr);\n\n  if (uiHash == null) {\n    uiHash = new RenderEventArgs();\n  }\n\n  uiHash.x = x + contentx;\n  uiHash.y = y + contenty;\n  uiHash.width = contentWidth - gap;\n  uiHash.height = contentHeight - gap;\n\n  if (element == null) {\n    element = this.getElementByTemplate(template);\n    style = mergeObjects(style, {\n      \"position\": \"absolute\",\n      \"padding\": \"0px\",\n      \"margin\": \"0px\"\n    }, attr);\n    JsonML.applyStyles(element, style);\n\n    uiHash.element = element;\n    uiHash.renderingMode = RenderingMode.Create;\n\n    if (onRenderTemplate !== null) {\n      onRenderTemplate(null, uiHash);\n    }\n    placeholder.activeLayer.canvas.appendChild(element);\n    this.m_cache.put(placeholder.name, placeholder.activeLayer.name, templateKey, element);\n  } else {\n    uiHash.element = element;\n    uiHash.renderingMode = RenderingMode.Update;\n    JsonML.applyStyles(element, style);\n    if (onRenderTemplate !== null) {\n      onRenderTemplate(null, uiHash);\n    }\n  }\n  return element;\n};\n\nGraphics.prototype.getElementByTemplate = function (template) {\n  var result = null;\n  if (Array.isArray(template)) {\n    result = JsonML.toHTML(template);\n  } else {\n    var parent = document.createElement('div');\n    parent.innerHTML = template;\n    result = parent.firstChild;\n  }\n  return result;\n};\n\nGraphics.prototype.getPxSize = function (value, base) {\n  var result = value;\n  if (typeof value === \"string\") {\n    if (value.indexOf(\"pt\") > 0) {\n      result = parseInt(value, 10) * 96 / 72;\n    }\n    else if (value.indexOf(\"%\") > 0) {\n      result = parseFloat(value) / 100.0 * base;\n    }\n    else {\n      result = parseInt(value, 10);\n    }\n  }\n  return result;\n};"]},"metadata":{},"sourceType":"module"}